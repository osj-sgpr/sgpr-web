<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGPR - Sistema de Gest√£o de Propriedades Rurais</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            max-width: 1200px;
            width: 100%;
            min-height: 600px;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .logo-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .logo-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .logo-text h1 {
            font-size: 3rem;
            font-weight: bold;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .logo-text p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin: 5px 0 0 0;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .feature-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .feature-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .feature-desc {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .main-content {
            padding: 40px;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .login-title {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .login-title h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .login-title p {
            color: #666;
            font-size: 1rem;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4CAF50;
            font-weight: 600;
            font-size: 1rem;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .support-link {
            text-align: center;
            margin-top: 20px;
        }

        .support-link a {
            color: #4CAF50;
            text-decoration: none;
            font-weight: 500;
        }

        .support-link a:hover {
            text-decoration: underline;
        }

        /* Dashboard Styles */
        .dashboard {
            display: none;
            padding: 20px;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info h2 {
            margin-bottom: 5px;
        }

        .user-info p {
            opacity: 0.9;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 1rem;
        }

        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .module-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .module-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #4CAF50;
        }

        .module-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .module-desc {
            color: #666;
            font-size: 1rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: #333;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-row .form-group {
            margin-bottom: 0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background: #4CAF50;
            color: white;
            font-weight: 600;
        }

        .data-table tr:hover {
            background: #f5f5f5;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header {
                padding: 20px;
            }

            .logo-text h1 {
                font-size: 2rem;
            }

            .features {
                grid-template-columns: 1fr;
            }

            .main-content {
                padding: 20px;
            }

            .login-section {
                padding: 30px 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Section -->
        <div id="loginSection">
            <div class="header">
                <div class="logo-container">
                    <div class="logo-image">
                        <img src="images/vaca.png" alt="SGPR Logo" onerror="this.style.display='none'">
                    </div>
                    <div class="logo-text">
                        <h1>SGPR</h1>
                        <p>Sistema de Gest√£o de Propriedades Rurais</p>
                    </div>
                </div>

                <div class="features">
                    <div class="feature-card">
                        <div class="feature-icon">üêÑ</div>
                        <div class="feature-title">Gest√£o de Animais</div>
                        <div class="feature-desc">Controle completo do seu rebanho</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üìä</div>
                        <div class="feature-title">Relat√≥rios Zoot√©cnicos</div>
                        <div class="feature-desc">An√°lises detalhadas e estat√≠sticas</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üí∞</div>
                        <div class="feature-title">Controle Financeiro</div>
                        <div class="feature-desc">Gest√£o de receitas e despesas</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üìÑ</div>
                        <div class="feature-title">Fichas de Campo</div>
                        <div class="feature-desc">PDFs para uso no campo</div>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="login-section">
                    <div class="login-title">
                        <h2>Acesso ao Sistema</h2>
                        <p>Entre com suas credenciais para acessar</p>
                    </div>

                    <div id="loginAlert" class="alert"></div>

                    <form id="loginForm">
                        <div class="form-group">
                            <label for="email">üìß Email</label>
                            <input type="email" id="email" name="email" required placeholder="seu@email.com">
                        </div>

                        <div class="form-group">
                            <label for="password">üîí Senha</label>
                            <input type="password" id="password" name="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>

                        <button type="submit" class="login-btn" id="loginBtn">
                            üö™ Entrar no Sistema
                        </button>
                    </form>

                    <div class="support-link">
                        <p>Problemas para acessar?</p>
                        <a href="#" onclick="showAlert('Entre em contato com o administrador do sistema.', 'info')">Entre em contato</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="dashboard">
            <div class="dashboard-header">
                <div class="user-info">
                    <h2 id="userName">Bem-vindo!</h2>
                    <p id="propertyName">Propriedade</p>
                </div>
                <button class="logout-btn" onclick="logout()">üö™ Sair</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üêÑ</div>
                    <div class="stat-number" id="totalAnimals">0</div>
                    <div class="stat-label">Total de Animais</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-number" id="monthlyBalance">R$ 0,00</div>
                    <div class="stat-label">Saldo Mensal</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ü§±</div>
                    <div class="stat-number" id="pregnantAnimals">0</div>
                    <div class="stat-label">F√™meas Gestantes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üíâ</div>
                    <div class="stat-number" id="pendingVaccines">0</div>
                    <div class="stat-label">Vacinas Pendentes</div>
                </div>
            </div>

            <div class="modules-grid">
                <div class="module-card" onclick="openModule('animals')">
                    <div class="module-icon">üêÑ</div>
                    <div class="module-title">Gest√£o de Animais</div>
                    <div class="module-desc">Cadastro e controle do rebanho</div>
                </div>

                <div class="module-card" onclick="openModule('financial')">
                    <div class="module-icon">üí∞</div>
                    <div class="module-title">Controle Financeiro</div>
                    <div class="module-desc">Receitas e despesas</div>
                </div>

                <div class="module-card" onclick="openModule('reproduction')">
                    <div class="module-icon">üíï</div>
                    <div class="module-title">Controle Reprodutivo</div>
                    <div class="module-desc">Insemina√ß√£o e gesta√ß√£o</div>
                </div>

                <div class="module-card" onclick="openModule('vaccines')">
                    <div class="module-icon">üíâ</div>
                    <div class="module-title">Controle Sanit√°rio</div>
                    <div class="module-desc">Vacinas e tratamentos</div>
                </div>

                <div class="module-card" onclick="openModule('reports')">
                    <div class="module-icon">üìä</div>
                    <div class="module-title">Relat√≥rios</div>
                    <div class="module-desc">An√°lises e fichas PDF</div>
                </div>

                <div class="module-card" onclick="openModule('goals')">
                    <div class="module-icon">üéØ</div>
                    <div class="module-title">Metas</div>
                    <div class="module-desc">Objetivos e acompanhamento</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="animalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Cadastro de Animal</h3>
                <span class="close" onclick="closeModal('animalModal')">&times;</span>
            </div>
            <form id="animalForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="animalNumber">N√∫mero</label>
                        <input type="text" id="animalNumber" name="numero" required>
                    </div>
                    <div class="form-group">
                        <label for="animalName">Nome</label>
                        <input type="text" id="animalName" name="nome">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="animalSex">Sexo</label>
                        <select id="animalSex" name="sexo" required>
                            <option value="">Selecione</option>
                            <option value="M">Macho</option>
                            <option value="F">F√™mea</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="animalBreed">Ra√ßa</label>
                        <input type="text" id="animalBreed" name="raca">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="birthDate">Data de Nascimento</label>
                        <input type="date" id="birthDate" name="dataNascimento">
                    </div>
                    <div class="form-group">
                        <label for="birthWeight">Peso Nascimento (kg)</label>
                        <input type="number" id="birthWeight" name="pesoNascimento" step="0.1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="currentWeight">Peso Atual (kg)</label>
                        <input type="number" id="currentWeight" name="pesoAtual" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="animalLot">Lote</label>
                        <input type="text" id="animalLot" name="lote">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="motherNumber">M√£e</label>
                        <input type="text" id="motherNumber" name="mae">
                    </div>
                    <div class="form-group">
                        <label for="fatherNumber">Pai</label>
                        <input type="text" id="fatherNumber" name="pai">
                    </div>
                </div>
                <div class="form-group">
                    <label for="animalObservations">Observa√ß√µes</label>
                    <textarea id="animalObservations" name="observacoes" rows="3"></textarea>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('animalModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Animal</button>
                </div>
            </form>
        </div>
    </div>

    <div id="financialModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nova Transa√ß√£o</h3>
                <span class="close" onclick="closeModal('financialModal')">&times;</span>
            </div>
            <form id="financialForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="transactionDate">Data</label>
                        <input type="date" id="transactionDate" name="data" required>
                    </div>
                    <div class="form-group">
                        <label for="transactionType">Tipo</label>
                        <select id="transactionType" name="tipo" required onchange="updateCategories()">
                            <option value="">Selecione</option>
                            <option value="Receita">Receita</option>
                            <option value="Despesa">Despesa</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="transactionCategory">Categoria</label>
                        <select id="transactionCategory" name="categoria" required>
                            <option value="">Selecione o tipo primeiro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transactionValue">Valor (R$)</label>
                        <input type="number" id="transactionValue" name="valor" step="0.01" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="transactionDescription">Descri√ß√£o</label>
                    <input type="text" id="transactionDescription" name="descricao" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="paymentMethod">Forma de Pagamento</label>
                        <select id="paymentMethod" name="formaPagamento">
                            <option value="">Selecione</option>
                            <option value="Dinheiro">Dinheiro</option>
                            <option value="PIX">PIX</option>
                            <option value="Cart√£o D√©bito">Cart√£o D√©bito</option>
                            <option value="Cart√£o Cr√©dito">Cart√£o Cr√©dito</option>
                            <option value="Transfer√™ncia">Transfer√™ncia</option>
                            <option value="Cheque">Cheque</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transactionObservations">Observa√ß√µes</label>
                        <input type="text" id="transactionObservations" name="observacoes">
                    </div>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('financialModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Transa√ß√£o</button>
                </div>
            </form>
        </div>
    </div>

    <div id="reproductionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Evento Reprodutivo</h3>
                <span class="close" onclick="closeModal('reproductionModal')">&times;</span>
            </div>
            <form id="reproductionForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="reproductionAnimal">Animal</label>
                        <select id="reproductionAnimal" name="animalId" required>
                            <option value="">Carregando animais...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reproductionEvent">Evento</label>
                        <select id="reproductionEvent" name="evento" required>
                            <option value="">Selecione</option>
                            <option value="Insemina√ß√£o">Insemina√ß√£o</option>
                            <option value="Diagn√≥stico Gesta√ß√£o">Diagn√≥stico Gesta√ß√£o</option>
                            <option value="Parto">Parto</option>
                            <option value="Aborto">Aborto</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="reproductionDate">Data</label>
                        <input type="date" id="reproductionDate" name="data" required>
                    </div>
                    <div class="form-group">
                        <label for="reproductionBull">Touro</label>
                        <input type="text" id="reproductionBull" name="touro">
                    </div>
                </div>
                <div class="form-group">
                    <label for="reproductionObservations">Observa√ß√µes</label>
                    <textarea id="reproductionObservations" name="observacoes" rows="3"></textarea>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('reproductionModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Evento</button>
                </div>
            </form>
        </div>
    </div>

    <div id="vaccineModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Vacina√ß√£o</h3>
                <span class="close" onclick="closeModal('vaccineModal')">&times;</span>
            </div>
            <form id="vaccineForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="vaccineAnimal">Animal</label>
                        <select id="vaccineAnimal" name="animalId" required>
                            <option value="">Carregando animais...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="vaccineType">Vacina</label>
                        <select id="vaccineType" name="vacina" required>
                            <option value="">Selecione</option>
                            <option value="Febre Aftosa">Febre Aftosa</option>
                            <option value="Brucelose">Brucelose</option>
                            <option value="Raiva">Raiva</option>
                            <option value="Clostridiose">Clostridiose</option>
                            <option value="IBR/BVD">IBR/BVD</option>
                            <option value="Leptospirose">Leptospirose</option>
                            <option value="Carb√∫nculo">Carb√∫nculo</option>
                            <option value="Verm√≠fugo">Verm√≠fugo</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="vaccineDate">Data Aplica√ß√£o</label>
                        <input type="date" id="vaccineDate" name="data" required>
                    </div>
                    <div class="form-group">
                        <label for="nextVaccineDate">Pr√≥xima Data</label>
                        <input type="date" id="nextVaccineDate" name="proximaData">
                    </div>
                </div>
                <div class="form-group">
                    <label for="vaccineObservations">Observa√ß√µes</label>
                    <textarea id="vaccineObservations" name="observacoes" rows="3"></textarea>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('vaccineModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Vacina√ß√£o</button>
                </div>
            </form>
        </div>
    </div>

    <div id="goalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nova Meta</h3>
                <span class="close" onclick="closeModal('goalModal')">&times;</span>
            </div>
            <form id="goalForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="goalType">Tipo de Meta</label>
                        <select id="goalType" name="tipo" required>
                            <option value="">Selecione</option>
                            <option value="GMD">Ganho M√©dio Di√°rio</option>
                            <option value="Taxa Prenhez">Taxa de Prenhez</option>
                            <option value="Peso M√©dio">Peso M√©dio</option>
                            <option value="Receita">Receita Mensal</option>
                            <option value="Lucro">Lucro Mensal</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="goalValue">Valor Meta</label>
                        <input type="number" id="goalValue" name="valorMeta" step="0.01" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="goalDescription">Descri√ß√£o</label>
                    <input type="text" id="goalDescription" name="descricao" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="goalStartDate">Data In√≠cio</label>
                        <input type="date" id="goalStartDate" name="dataInicio" required>
                    </div>
                    <div class="form-group">
                        <label for="goalEndDate">Data Fim</label>
                        <input type="date" id="goalEndDate" name="dataFim" required>
                    </div>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('goalModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Meta</button>
                </div>
            </form>
        </div>
    </div>

    <div id="dataModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="dataModalTitle">Dados</h3>
                <span class="close" onclick="closeModal('dataModal')">&times;</span>
            </div>
            <div id="dataModalContent">
                <div class="loading">Carregando dados...</div>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√£o da API
        const CONFIG = {
            API_URL: 'https://script.google.com/macros/s/AKfycbxkC2-X5jWFx2mfNn6-eGag0M9uy-k5gq6x35AVHeTZ1ylFPOu_0ddGphh6UpZ3gb57/exec',
            SYSTEM_NAME: 'SGPR - Sistema de Gest√£o de Propriedades Rurais'
        };

        // Vari√°veis globais
        let currentUser = null;
        let currentAnimals = [];

        // Categorias financeiras (22 categorias em ordem cronol√≥gica)
        const FINANCIAL_CATEGORIES = {
            'Receita': [
                '01 - Venda de Animais',
                '02 - Venda de Leite',
                '03 - Venda de Produtos Derivados',
                '04 - Presta√ß√£o de Servi√ßos',
                '05 - Aluguel de Pastos',
                '06 - Outras Receitas'
            ],
            'Despesa': [
                '07 - Alimenta√ß√£o Animal',
                '08 - Medicamentos e Vacinas',
                '09 - Reprodu√ß√£o',
                '10 - M√£o de Obra',
                '11 - Combust√≠vel',
                '12 - Energia El√©trica',
                '13 - Manuten√ß√£o de Equipamentos',
                '14 - Manuten√ß√£o de Instala√ß√µes',
                '15 - Impostos e Taxas',
                '16 - Seguros',
                '17 - Transporte',
                '18 - Consultoria T√©cnica',
                '19 - An√°lises Laboratoriais',
                '20 - Material de Escrit√≥rio',
                '21 - Despesas Banc√°rias',
                '22 - Outras Despesas'
            ]
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se j√° est√° logado
            const savedUser = localStorage.getItem('sgpr_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
            }

            // Event listeners
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('animalForm').addEventListener('submit', handleSaveAnimal);
            document.getElementById('financialForm').addEventListener('submit', handleSaveTransaction);
            document.getElementById('reproductionForm').addEventListener('submit', handleSaveReproduction);
            document.getElementById('vaccineForm').addEventListener('submit', handleSaveVaccination);
            document.getElementById('goalForm').addEventListener('submit', handleSaveGoal);

            // Definir data atual nos formul√°rios
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transactionDate').value = today;
            document.getElementById('reproductionDate').value = today;
            document.getElementById('vaccineDate').value = today;
            document.getElementById('goalStartDate').value = today;
        });

        // Fun√ß√µes de autentica√ß√£o
        async function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            
            loginBtn.disabled = true;
            loginBtn.textContent = 'üîÑ Entrando...';
            
            try {
                const response = await makeAPICall('login', {
                    email: email,
                    password: password
                });
                
                if (response.success) {
                    currentUser = response.data.user;
                    localStorage.setItem('sgpr_user', JSON.stringify(currentUser));
                    showAlert('Login realizado com sucesso!', 'success');
                    setTimeout(() => {
                        showDashboard();
                    }, 1000);
                } else {
                    showAlert(response.message, 'error');
                }
            } catch (error) {
                console.error('Erro no login:', error);
                showAlert('Erro de conex√£o. Tente novamente.', 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'üö™ Entrar no Sistema';
            }
        }

        function logout() {
            localStorage.removeItem('sgpr_user');
            currentUser = null;
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('loginForm').reset();
            showAlert('Logout realizado com sucesso!', 'success');
        }

        function showDashboard() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'block';
            
            // Atualizar informa√ß√µes do usu√°rio
            document.getElementById('userName').textContent = `Bem-vindo, ${currentUser.name}!`;
            document.getElementById('propertyName').textContent = currentUser.propertyName;
            
            // Carregar estat√≠sticas
            loadDashboardStats();
        }

        async function loadDashboardStats() {
            try {
                // Carregar animais
                const animalsResponse = await makeAPICall('getAnimals', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId
                });
                
                if (animalsResponse.success) {
                    currentAnimals = animalsResponse.data;
                    document.getElementById('totalAnimals').textContent = currentAnimals.length;
                }

                // Carregar dados financeiros
                const financialResponse = await makeAPICall('getFinancial', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId
                });
                
                if (financialResponse.success) {
                    const transactions = financialResponse.data;
                    const currentMonth = new Date().getMonth();
                    const currentYear = new Date().getFullYear();
                    
                    let monthlyRevenue = 0;
                    let monthlyExpenses = 0;
                    
                    transactions.forEach(transaction => {
                        const transactionDate = new Date(transaction.data);
                        if (transactionDate.getMonth() === currentMonth && transactionDate.getFullYear() === currentYear) {
                            const value = parseFloat(transaction.valor) || 0;
                            if (transaction.tipo === 'Receita') {
                                monthlyRevenue += value;
                            } else if (transaction.tipo === 'Despesa') {
                                monthlyExpenses += value;
                            }
                        }
                    });
                    
                    const balance = monthlyRevenue - monthlyExpenses;
                    document.getElementById('monthlyBalance').textContent = `R$ ${balance.toFixed(2).replace('.', ',')}`;
                }

                // Carregar dados reprodutivos
                const reproductionResponse = await makeAPICall('getReproduction', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId
                });
                
                if (reproductionResponse.success) {
                    const events = reproductionResponse.data;
                    const pregnantCount = events.filter(event => 
                        event.evento === 'Insemina√ß√£o' || event.evento === 'Diagn√≥stico Gesta√ß√£o'
                    ).length;
                    document.getElementById('pregnantAnimals').textContent = pregnantCount;
                }

                // Carregar dados de vacinas
                const vaccinesResponse = await makeAPICall('getVaccines', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId
                });
                
                if (vaccinesResponse.success) {
                    const vaccines = vaccinesResponse.data;
                    const nextWeek = new Date();
                    nextWeek.setDate(nextWeek.getDate() + 7);
                    
                    const pendingCount = vaccines.filter(vaccine => {
                        if (vaccine.proximadata) {
                            const nextDate = new Date(vaccine.proximadata);
                            return nextDate <= nextWeek;
                        }
                        return false;
                    }).length;
                    
                    document.getElementById('pendingVaccines').textContent = pendingCount;
                }

            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas:', error);
            }
        }

        // Fun√ß√µes de m√≥dulos
        function openModule(moduleName) {
            switch (moduleName) {
                case 'animals':
                    openAnimalsModule();
                    break;
                case 'financial':
                    openFinancialModule();
                    break;
                case 'reproduction':
                    openReproductionModule();
                    break;
                case 'vaccines':
                    openVaccinesModule();
                    break;
                case 'reports':
                    openReportsModule();
                    break;
                case 'goals':
                    openGoalsModule();
                    break;
            }
        }

        async function openAnimalsModule() {
            document.getElementById('dataModalTitle').textContent = 'Gest√£o de Animais';
            document.getElementById('dataModalContent').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openModal('animalModal')">‚ûï Novo Animal</button>
                </div>
                <div class="loading">Carregando animais...</div>
            `;
            document.getElementById('dataModal').style.display = 'block';

            try {
                const response = await makeAPICall('getAnimals', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId
                });

                if (response.success) {
                    currentAnimals = response.data;
                    displayAnimalsTable(currentAnimals);
                } else {
                    document.getElementById('dataModalContent').innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <button class="btn btn-primary" onclick="openModal('animalModal')">‚ûï Novo Animal</button>
                        </div>
                        <p>Erro ao carregar animais: ${response.message}</p>
                    `;
                }
            } catch (error) {
                console.error('Erro ao carregar animais:', error);
                document.getElementById('dataModalContent').innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="openModal('animalModal')">‚ûï Novo Animal</button>
                    </div>
                    <p>Erro de conex√£o ao carregar animais.</p>
                `;
            }
        }

        function displayAnimalsTable(animals) {
            let tableHTML = `
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openModal('animalModal')">‚ûï Novo Animal</button>
                </div>
            `;

            if (animals.length === 0) {
                tableHTML += '<p>Nenhum animal cadastrado ainda.</p>';
            } else {
                tableHTML += `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>N√∫mero</th>
                                <th>Nome</th>
                                <th>Sexo</th>
                                <th>Ra√ßa</th>
                                <th>Peso Atual</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                animals.forEach(animal => {
                    tableHTML += `
                        <tr>
                            <td>${animal.numero || ''}</td>
                            <td>${animal.nome || ''}</td>
                            <td>${animal.sexo || ''}</td>
                            <td>${animal.raca || ''}</td>
                            <td>${animal.pesoatual ? animal.pesoatual + ' kg' : ''}</td>
                            <td>
                                <button class="btn btn-danger" onclick="deleteAnimal(${animal.id})" style="font-size: 0.8rem; padding: 5px 10px;">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                });

                tableHTML += '</tbody></table>';
            }

            document.getElementById('dataModalContent').innerHTML = tableHTML;
        }

        async function handleSaveAnimal(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const animalData = Object.fromEntries(formData.entries());
            
            try {
                const response = await makeAPICall('saveAnimal', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId,
                    animal: JSON.stringify(animalData)
                });
                
                if (response.success) {
                    showAlert('Animal salvo com sucesso!', 'success');
                    closeModal('animalModal');
                    document.getElementById('animalForm').reset();
                    openAnimalsModule(); // Recarregar lista
                    loadDashboardStats(); // Atualizar estat√≠sticas
                } else {
                    showAlert(response.message, 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar animal:', error);
                showAlert('Erro ao salvar animal.', 'error');
            }
        }

        async function deleteAnimal(animalId) {
            if (!confirm('Tem certeza que deseja excluir este animal?')) {
                return;
            }
            
            try {
                const response = await makeAPICall('deleteAnimal', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId,
                    animalId: animalId
                });
                
                if (response.success) {
                    showAlert('Animal exclu√≠do com sucesso!', 'success');
                    openAnimalsModule(); // Recarregar lista
                    loadDashboardStats(); // Atualizar estat√≠sticas
                } else {
                    showAlert(response.message, 'error');
                }
            } catch (error) {
                console.error('Erro ao excluir animal:', error);
                showAlert('Erro ao excluir animal.', 'error');
            }
        }

        async function openFinancialModule() {
            document.getElementById('dataModalTitle').textContent = 'Controle Financeiro';
            document.getElementById('dataModalContent').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openModal('financialModal')">‚ûï Nova Transa√ß√£o</button>
                </div>
                <div class="loading">Carregando transa√ß√µes...</div>
            `;
            document.getElementById('dataModal').style.display = 'block';

            try {
                const response = await makeAPICall('getFinancial', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId
                });

                if (response.success) {
                    displayFinancialTable(response.data);
                } else {
                    document.getElementById('dataModalContent').innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <button class="btn btn-primary" onclick="openModal('financialModal')">‚ûï Nova Transa√ß√£o</button>
                        </div>
                        <p>Erro ao carregar transa√ß√µes: ${response.message}</p>
                    `;
                }
            } catch (error) {
                console.error('Erro ao carregar transa√ß√µes:', error);
                document.getElementById('dataModalContent').innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="openModal('financialModal')">‚ûï Nova Transa√ß√£o</button>
                    </div>
                    <p>Erro de conex√£o ao carregar transa√ß√µes.</p>
                `;
            }
        }

        function displayFinancialTable(transactions) {
            let tableHTML = `
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openModal('financialModal')">‚ûï Nova Transa√ß√£o</button>
                </div>
            `;

            if (transactions.length === 0) {
                tableHTML += '<p>Nenhuma transa√ß√£o cadastrada ainda.</p>';
            } else {
                tableHTML += `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Tipo</th>
                                <th>Categoria</th>
                                <th>Valor</th>
                                <th>Descri√ß√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                transactions.forEach(transaction => {
                    const value = parseFloat(transaction.valor) || 0;
                    const formattedValue = `R$ ${value.toFixed(2).replace('.', ',')}`;
                    const valueClass = transaction.tipo === 'Receita' ? 'color: green' : 'color: red';
                    
                    tableHTML += `
                        <tr>
                            <td>${transaction.data ? new Date(transaction.data).toLocaleDateString('pt-BR') : ''}</td>
                            <td>${transaction.tipo || ''}</td>
                            <td>${transaction.categoria || ''}</td>
                            <td style="${valueClass}">${formattedValue}</td>
                            <td>${transaction.descricao || ''}</td>
                            <td>
                                <button class="btn btn-danger" onclick="deleteTransaction(${transaction.id})" style="font-size: 0.8rem; padding: 5px 10px;">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                });

                tableHTML += '</tbody></table>';
            }

            document.getElementById('dataModalContent').innerHTML = tableHTML;
        }

        function updateCategories() {
            const typeSelect = document.getElementById('transactionType');
            const categorySelect = document.getElementById('transactionCategory');
            const selectedType = typeSelect.value;
            
            categorySelect.innerHTML = '<option value="">Selecione uma categoria</option>';
            
            if (selectedType && FINANCIAL_CATEGORIES[selectedType]) {
                FINANCIAL_CATEGORIES[selectedType].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
            }
        }

        async function handleSaveTransaction(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const transactionData = Object.fromEntries(formData.entries());
            
            try {
                const response = await makeAPICall('saveTransaction', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId,
                    transaction: JSON.stringify(transactionData)
                });
                
                if (response.success) {
                    showAlert('Transa√ß√£o salva com sucesso!', 'success');
                    closeModal('financialModal');
                    document.getElementById('financialForm').reset();
                    openFinancialModule(); // Recarregar lista
                    loadDashboardStats(); // Atualizar estat√≠sticas
                } else {
                    showAlert(response.message, 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar transa√ß√£o:', error);
                showAlert('Erro ao salvar transa√ß√£o.', 'error');
            }
        }

        async function deleteTransaction(transactionId) {
            if (!confirm('Tem certeza que deseja excluir esta transa√ß√£o?')) {
                return;
            }
            
            try {
                const response = await makeAPICall('deleteTransaction', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId,
                    transactionId: transactionId
                });
                
                if (response.success) {
                    showAlert('Transa√ß√£o exclu√≠da com sucesso!', 'success');
                    openFinancialModule(); // Recarregar lista
                    loadDashboardStats(); // Atualizar estat√≠sticas
                } else {
                    showAlert(response.message, 'error');
                }
            } catch (error) {
                console.error('Erro ao excluir transa√ß√£o:', error);
                showAlert('Erro ao excluir transa√ß√£o.', 'error');
            }
        }

        async function openReproductionModule() {
            // Carregar animais para o select
            await loadAnimalsForSelect('reproductionAnimal');
            
            document.getElementById('dataModalTitle').textContent = 'Controle Reprodutivo';
            document.getElementById('dataModalContent').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openModal('reproductionModal')">‚ûï Novo Evento</button>
                </div>
                <div class="loading">Carregando eventos reprodutivos...</div>
            `;
            document.getElementById('dataModal').style.display = 'block';

            try {
                const response = await makeAPICall('getReproduction', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId
                });

                if (response.success) {
                    displayReproductionTable(response.data);
                } else {
                    document.getElementById('dataModalContent').innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <button class="btn btn-primary" onclick="openModal('reproductionModal')">‚ûï Novo Evento</button>
                        </div>
                        <p>Erro ao carregar eventos: ${response.message}</p>
                    `;
                }
            } catch (error) {
                console.error('Erro ao carregar eventos reprodutivos:', error);
                document.getElementById('dataModalContent').innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="openModal('reproductionModal')">‚ûï Novo Evento</button>
                    </div>
                    <p>Erro de conex√£o ao carregar eventos.</p>
                `;
            }
        }

        function displayReproductionTable(events) {
            let tableHTML = `
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openModal('reproductionModal')">‚ûï Novo Evento</button>
                </div>
            `;

            if (events.length === 0) {
                tableHTML += '<p>Nenhum evento reprodutivo cadastrado ainda.</p>';
            } else {
                tableHTML += `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Animal</th>
                                <th>Evento</th>
                                <th>Data</th>
                                <th>Touro</th>
                                <th>Previs√£o Parto</th>
                                <th>Observa√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                events.forEach(event => {
                    // Buscar nome do animal
                    const animal = currentAnimals.find(a => a.id == event.animalid);
                    const animalName = animal ? `${animal.numero} - ${animal.nome}` : event.animalid;
                    
                    tableHTML += `
                        <tr>
                            <td>${animalName}</td>
                            <td>${event.evento || ''}</td>
                            <td>${event.data ? new Date(event.data).toLocaleDateString('pt-BR') : ''}</td>
                            <td>${event.touro || ''}</td>
                            <td>${event.previsaoparto ? new Date(event.previsaoparto).toLocaleDateString('pt-BR') : ''}</td>
                            <td>${event.observacoes || ''}</td>
                        </tr>
                    `;
                });

                tableHTML += '</tbody></table>';
            }

            document.getElementById('dataModalContent').innerHTML = tableHTML;
        }

        async function handleSaveReproduction(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const reproductionData = Object.fromEntries(formData.entries());
            
            try {
                const response = await makeAPICall('saveReproduction', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId,
                    reproduction: JSON.stringify(reproductionData)
                });
                
                if (response.success) {
                    showAlert('Evento reprodutivo salvo com sucesso!', 'success');
                    closeModal('reproductionModal');
                    document.getElementById('reproductionForm').reset();
                    openReproductionModule(); // Recarregar lista
                    loadDashboardStats(); // Atualizar estat√≠sticas
                } else {
                    showAlert(response.message, 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar evento reprodutivo:', error);
                showAlert('Erro ao salvar evento reprodutivo.', 'error');
            }
        }

        async function openVaccinesModule() {
            // Carregar animais para o select
            await loadAnimalsForSelect('vaccineAnimal');
            
            document.getElementById('dataModalTitle').textContent = 'Controle Sanit√°rio';
            document.getElementById('dataModalContent').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openModal('vaccineModal')">‚ûï Nova Vacina√ß√£o</button>
                </div>
                <div class="loading">Carregando vacina√ß√µes...</div>
            `;
            document.getElementById('dataModal').style.display = 'block';

            try {
                const response = await makeAPICall('getVaccines', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId
                });

                if (response.success) {
                    displayVaccinesTable(response.data);
                } else {
                    document.getElementById('dataModalContent').innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <button class="btn btn-primary" onclick="openModal('vaccineModal')">‚ûï Nova Vacina√ß√£o</button>
                        </div>
                        <p>Erro ao carregar vacina√ß√µes: ${response.message}</p>
                    `;
                }
            } catch (error) {
                console.error('Erro ao carregar vacina√ß√µes:', error);
                document.getElementById('dataModalContent').innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="openModal('vaccineModal')">‚ûï Nova Vacina√ß√£o</button>
                    </div>
                    <p>Erro de conex√£o ao carregar vacina√ß√µes.</p>
                `;
            }
        }

        function displayVaccinesTable(vaccines) {
            let tableHTML = `
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openModal('vaccineModal')">‚ûï Nova Vacina√ß√£o</button>
                </div>
            `;

            if (vaccines.length === 0) {
                tableHTML += '<p>Nenhuma vacina√ß√£o cadastrada ainda.</p>';
            } else {
                tableHTML += `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Animal</th>
                                <th>Vacina</th>
                                <th>Data Aplica√ß√£o</th>
                                <th>Pr√≥xima Data</th>
                                <th>Status</th>
                                <th>Observa√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                vaccines.forEach(vaccine => {
                    // Buscar nome do animal
                    const animal = currentAnimals.find(a => a.id == vaccine.animalid);
                    const animalName = animal ? `${animal.numero} - ${animal.nome}` : vaccine.animalid;
                    
                    // Calcular status
                    let status = 'Em dia';
                    let statusColor = 'green';
                    
                    if (vaccine.proximadata) {
                        const nextDate = new Date(vaccine.proximadata);
                        const today = new Date();
                        const diffDays = Math.ceil((nextDate - today) / (1000 * 60 * 60 * 24));
                        
                        if (diffDays < 0) {
                            status = 'Vencida';
                            statusColor = 'red';
                        } else if (diffDays <= 7) {
                            status = 'Pr√≥xima';
                            statusColor = 'orange';
                        }
                    }
                    
                    tableHTML += `
                        <tr>
                            <td>${animalName}</td>
                            <td>${vaccine.vacina || ''}</td>
                            <td>${vaccine.data ? new Date(vaccine.data).toLocaleDateString('pt-BR') : ''}</td>
                            <td>${vaccine.proximadata ? new Date(vaccine.proximadata).toLocaleDateString('pt-BR') : ''}</td>
                            <td style="color: ${statusColor}; font-weight: bold;">${status}</td>
                            <td>${vaccine.observacoes || ''}</td>
                        </tr>
                    `;
                });

                tableHTML += '</tbody></table>';
            }

            document.getElementById('dataModalContent').innerHTML = tableHTML;
        }

        async function handleSaveVaccination(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const vaccinationData = Object.fromEntries(formData.entries());
            
            try {
                const response = await makeAPICall('saveVaccination', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId,
                    vaccination: JSON.stringify(vaccinationData)
                });
                
                if (response.success) {
                    showAlert('Vacina√ß√£o salva com sucesso!', 'success');
                    closeModal('vaccineModal');
                    document.getElementById('vaccineForm').reset();
                    openVaccinesModule(); // Recarregar lista
                    loadDashboardStats(); // Atualizar estat√≠sticas
                } else {
                    showAlert(response.message, 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar vacina√ß√£o:', error);
                showAlert('Erro ao salvar vacina√ß√£o.', 'error');
            }
        }

        async function openGoalsModule() {
            document.getElementById('dataModalTitle').textContent = 'Metas e Objetivos';
            document.getElementById('dataModalContent').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openModal('goalModal')">‚ûï Nova Meta</button>
                </div>
                <div class="loading">Carregando metas...</div>
            `;
            document.getElementById('dataModal').style.display = 'block';

            try {
                const response = await makeAPICall('getGoals', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId
                });

                if (response.success) {
                    displayGoalsTable(response.data);
                } else {
                    document.getElementById('dataModalContent').innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <button class="btn btn-primary" onclick="openModal('goalModal')">‚ûï Nova Meta</button>
                        </div>
                        <p>Erro ao carregar metas: ${response.message}</p>
                    `;
                }
            } catch (error) {
                console.error('Erro ao carregar metas:', error);
                document.getElementById('dataModalContent').innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="openModal('goalModal')">‚ûï Nova Meta</button>
                    </div>
                    <p>Erro de conex√£o ao carregar metas.</p>
                `;
            }
        }

        function displayGoalsTable(goals) {
            let tableHTML = `
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openModal('goalModal')">‚ûï Nova Meta</button>
                </div>
            `;

            if (goals.length === 0) {
                tableHTML += '<p>Nenhuma meta cadastrada ainda.</p>';
            } else {
                tableHTML += `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Tipo</th>
                                <th>Descri√ß√£o</th>
                                <th>Meta</th>
                                <th>Atual</th>
                                <th>Progresso</th>
                                <th>Status</th>
                                <th>Per√≠odo</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                goals.forEach(goal => {
                    const meta = parseFloat(goal.valormeta) || 0;
                    const atual = parseFloat(goal.valoratual) || 0;
                    const progresso = meta > 0 ? ((atual / meta) * 100).toFixed(1) : 0;
                    
                    let statusColor = 'orange';
                    let statusText = 'Em andamento';
                    
                    if (progresso >= 100) {
                        statusColor = 'green';
                        statusText = 'Conclu√≠da';
                    } else if (progresso >= 80) {
                        statusColor = 'blue';
                        statusText = 'Pr√≥xima';
                    }
                    
                    const periodo = `${goal.datainicio ? new Date(goal.datainicio).toLocaleDateString('pt-BR') : ''} - ${goal.datafim ? new Date(goal.datafim).toLocaleDateString('pt-BR') : ''}`;
                    
                    tableHTML += `
                        <tr>
                            <td>${goal.tipo || ''}</td>
                            <td>${goal.descricao || ''}</td>
                            <td>${meta}</td>
                            <td>${atual}</td>
                            <td>${progresso}%</td>
                            <td style="color: ${statusColor}; font-weight: bold;">${statusText}</td>
                            <td>${periodo}</td>
                        </tr>
                    `;
                });

                tableHTML += '</tbody></table>';
            }

            document.getElementById('dataModalContent').innerHTML = tableHTML;
        }

        async function handleSaveGoal(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const goalData = Object.fromEntries(formData.entries());
            
            try {
                const response = await makeAPICall('saveGoal', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId,
                    goal: JSON.stringify(goalData)
                });
                
                if (response.success) {
                    showAlert('Meta salva com sucesso!', 'success');
                    closeModal('goalModal');
                    document.getElementById('goalForm').reset();
                    openGoalsModule(); // Recarregar lista
                } else {
                    showAlert(response.message, 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar meta:', error);
                showAlert('Erro ao salvar meta.', 'error');
            }
        }

        async function openReportsModule() {
            document.getElementById('dataModalTitle').textContent = 'Relat√≥rios e Fichas';
            document.getElementById('dataModalContent').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                    <button class="btn btn-primary" onclick="generateFieldForm('Cadastro')" style="padding: 15px;">üìÑ Ficha de Cadastro</button>
                    <button class="btn btn-primary" onclick="generateFieldForm('Pesagem')" style="padding: 15px;">‚öñÔ∏è Ficha de Pesagem</button>
                    <button class="btn btn-primary" onclick="generateFieldForm('Inseminacao')" style="padding: 15px;">üíï Ficha de Insemina√ß√£o</button>
                    <button class="btn btn-primary" onclick="generateFieldForm('TaxaPrenhez')" style="padding: 15px;">ü§± Taxa de Prenhez</button>
                </div>
                
                <h4 style="margin: 30px 0 15px 0; color: #333;">üìä Relat√≥rios Zoot√©cnicos</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <button class="btn btn-secondary" onclick="generateReport('animals')" style="padding: 15px;">üêÑ Relat√≥rio de Animais</button>
                    <button class="btn btn-secondary" onclick="generateReport('financial')" style="padding: 15px;">üí∞ Relat√≥rio Financeiro</button>
                    <button class="btn btn-secondary" onclick="generateReport('reproduction')" style="padding: 15px;">üíï Relat√≥rio Reprodutivo</button>
                    <button class="btn btn-secondary" onclick="generateReport('performance')" style="padding: 15px;">üìà Relat√≥rio de Performance</button>
                </div>
                
                <div id="reportResults" style="margin-top: 30px;"></div>
            `;
            document.getElementById('dataModal').style.display = 'block';
        }

        async function generateFieldForm(formType) {
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'üîÑ Gerando...';
            button.disabled = true;
            
            try {
                const response = await makeAPICall('generateFieldForm', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId,
                    formType: formType
                });
                
                if (response.success) {
                    showAlert('Ficha gerada com sucesso!', 'success');
                    
                    // Mostrar link para download
                    const resultsDiv = document.getElementById('reportResults');
                    resultsDiv.innerHTML = `
                        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-top: 15px;">
                            <h5>‚úÖ Ficha de ${formType} gerada com sucesso!</h5>
                            <p><strong>Arquivo:</strong> ${response.data.fileName}</p>
                            <a href="${response.data.fileUrl}" target="_blank" class="btn btn-primary" style="margin-top: 10px;">üì• Baixar Ficha</a>
                        </div>
                    `;
                } else {
                    showAlert(response.message, 'error');
                }
            } catch (error) {
                console.error('Erro ao gerar ficha:', error);
                showAlert('Erro ao gerar ficha.', 'error');
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        }

        async function generateReport(reportType) {
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'üîÑ Gerando...';
            button.disabled = true;
            
            try {
                const response = await makeAPICall('getReports', {
                    propertySpreadsheetId: currentUser.propertySpreadsheetId,
                    reportType: reportType
                });
                
                if (response.success) {
                    displayReportResults(reportType, response.data);
                } else {
                    showAlert(response.message, 'error');
                }
            } catch (error) {
                console.error('Erro ao gerar relat√≥rio:', error);
                showAlert('Erro ao gerar relat√≥rio.', 'error');
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        }

        function displayReportResults(reportType, data) {
            const resultsDiv = document.getElementById('reportResults');
            let html = '';
            
            switch (reportType) {
                case 'animals':
                    html = `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 15px;">
                            <h5>üêÑ Relat√≥rio de Animais</h5>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 15px 0;">
                                <div style="text-align: center; background: white; padding: 15px; border-radius: 8px;">
                                    <div style="font-size: 2rem; color: #4CAF50;">${data.totalAnimals}</div>
                                    <div>Total de Animais</div>
                                </div>
                                <div style="text-align: center; background: white; padding: 15px; border-radius: 8px;">
                                    <div style="font-size: 2rem; color: #2196F3;">${data.maleAnimals}</div>
                                    <div>Machos</div>
                                </div>
                                <div style="text-align: center; background: white; padding: 15px; border-radius: 8px;">
                                    <div style="font-size: 2rem; color: #E91E63;">${data.femaleAnimals}</div>
                                    <div>F√™meas</div>
                                </div>
                                <div style="text-align: center; background: white; padding: 15px; border-radius: 8px;">
                                    <div style="font-size: 2rem; color: #FF9800;">${data.averageWeight} kg</div>
                                    <div>Peso M√©dio</div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'financial':
                    html = `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 15px;">
                            <h5>üí∞ Relat√≥rio Financeiro</h5>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 15px 0;">
                                <div style="text-align: center; background: white; padding: 15px; border-radius: 8px;">
                                    <div style="font-size: 1.5rem; color: green;">R$ ${data.totalRevenue}</div>
                                    <div>Total Receitas</div>
                                </div>
                                <div style="text-align: center; background: white; padding: 15px; border-radius: 8px;">
                                    <div style="font-size: 1.5rem; color: red;">R$ ${data.totalExpenses}</div>
                                    <div>Total Despesas</div>
                                </div>
                                <div style="text-align: center; background: white; padding: 15px; border-radius: 8px;">
                                    <div style="font-size: 1.5rem; color: ${parseFloat(data.balance) >= 0 ? 'green' : 'red'};">R$ ${data.balance}</div>
                                    <div>Saldo</div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'reproduction':
                    html = `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 15px;">
                            <h5>üíï Relat√≥rio Reprodutivo</h5>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 15px 0;">
                                <div style="text-align: center; background: white; padding: 15px; border-radius: 8px;">
                                    <div style="font-size: 2rem; color: #E91E63;">${data.totalEvents}</div>
                                    <div>Total Eventos</div>
                                </div>
                                <div style="text-align: center; background: white; padding: 15px; border-radius: 8px;">
                                    <div style="font-size: 2rem; color: #9C27B0;">${data.pregnantAnimals}</div>
                                    <div>Animais Gestantes</div>
                                </div>
                                <div style="text-align: center; background: white; padding: 15px; border-radius: 8px;">
                                    <div style="font-size: 2rem; color: #FF9800;">${data.expectedBirths}</div>
                                    <div>Partos Previstos</div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'performance':
                    html = `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 15px;">
                            <h5>üìà Relat√≥rio de Performance</h5>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 15px 0;">
                                <div style="text-align: center; background: white; padding: 15px; border-radius: 8px;">
                                    <div style="font-size: 1.5rem; color: #4CAF50;">${data.averageGMD} kg/dia</div>
                                    <div>GMD M√©dio</div>
                                </div>
                                <div style="text-align: center; background: white; padding: 15px; border-radius: 8px;">
                                    <div style="font-size: 1.5rem; color: #2196F3;">${data.animalCount}</div>
                                    <div>Animais Avaliados</div>
                                </div>
                                <div style="text-align: center; background: white; padding: 15px; border-radius: 8px;">
                                    <div style="font-size: 1.2rem; color: green;">R$ ${data.monthlyRevenue}</div>
                                    <div>Receita Mensal</div>
                                </div>
                                <div style="text-align: center; background: white; padding: 15px; border-radius: 8px;">
                                    <div style="font-size: 1.2rem; color: ${parseFloat(data.monthlyBalance) >= 0 ? 'green' : 'red'};">R$ ${data.monthlyBalance}</div>
                                    <div>Saldo Mensal</div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            resultsDiv.innerHTML = html;
        }

        // Fun√ß√µes auxiliares
        async function loadAnimalsForSelect(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Carregando animais...</option>';
            
            try {
                if (currentAnimals.length === 0) {
                    const response = await makeAPICall('getAnimals', {
                        propertySpreadsheetId: currentUser.propertySpreadsheetId
                    });
                    
                    if (response.success) {
                        currentAnimals = response.data;
                    }
                }
                
                select.innerHTML = '<option value="">Selecione um animal</option>';
                currentAnimals.forEach(animal => {
                    const option = document.createElement('option');
                    option.value = animal.id;
                    option.textContent = `${animal.numero} - ${animal.nome || 'Sem nome'}`;
                    select.appendChild(option);
                });
                
            } catch (error) {
                console.error('Erro ao carregar animais para select:', error);
                select.innerHTML = '<option value="">Erro ao carregar animais</option>';
            }
        }

        // Fun√ß√µes de modal
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Fechar modal clicando fora
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Fun√ß√£o de alerta
        function showAlert(message, type) {
            const alert = document.getElementById('loginAlert');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // Fun√ß√£o para fazer chamadas √† API
        async function makeAPICall(action, params) {
            const formData = new FormData();
            formData.append('action', action);
            
            for (const [key, value] of Object.entries(params)) {
                formData.append(key, value);
            }
            
            const response = await fetch(CONFIG.API_URL, {
                method: 'POST',
                body: formData
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            return await response.json();
        }
    </script>
</body>
</html>

