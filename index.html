<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGPR - Sistema de Gest√£o de Propriedades Rurais</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .logo img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
        }

        .logo h1 {
            font-size: 2.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .login-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 400px;
            margin: 0 auto;
        }

        .login-section h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #4CAF50;
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .btn {
            background: #4CAF50;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
            width: 100%;
            font-weight: 600;
        }

        .btn:hover {
            background: #45a049;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
            width: auto;
            margin: 0 5px;
        }

        .btn-danger {
            background: #f44336;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .dashboard {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .dashboard-header h2 {
            color: #4CAF50;
            font-size: 1.8rem;
        }

        .user-info {
            text-align: right;
        }

        .modules {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .module-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .module-card:hover {
            border-color: #4CAF50;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .module-card .icon {
            font-size: 2.2rem;
            margin-bottom: 12px;
            color: #4CAF50;
        }

        .module-card h3 {
            margin-bottom: 8px;
            color: #333;
            font-size: 1.1rem;
        }

        .module-card p {
            color: #666;
            font-size: 0.85rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .stat-card h3 {
            font-size: 1.8rem;
            color: #4CAF50;
            margin-bottom: 5px;
        }

        .stat-card p {
            color: #666;
            font-size: 0.9rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            min-width: 500px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f0f0f0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .table th, .table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .alert {
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 5px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .autocomplete {
            position: relative;
        }

        .autocomplete-items {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 5px 5px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
        }

        .autocomplete-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }

        .autocomplete-item:hover {
            background: #f0f0f0;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            border-bottom-color: #4CAF50;
            color: #4CAF50;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .logo h1 {
                font-size: 2rem;
            }
            
            .modules {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                min-width: 95%;
                padding: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Se√ß√£o de Login -->
        <div id="loginSection">
            <div class="header">
                <div class="logo">
                    <img src="https://static.wixstatic.com/ficons/96b2d1_c3c41995985e4542bcee96c14fe1b8d3~mv2.ico" alt="SGPR Logo" onerror="this.style.display='none'">
                    <h1>SGPR</h1>
                </div>
                <p class="subtitle">Sistema de Gest√£o de Propriedades Rurais</p>
            </div>

            <div class="login-section">
                <h2>Acesso ao Sistema</h2>
                
                <div class="alert alert-error" id="loginError"></div>
                
                <form id="loginForm">
                    <div class="form-group">
                        <label for="email">üìß Email</label>
                        <input type="email" id="email" name="email" required placeholder="teste@sgpr.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="senha">üîí Senha</label>
                        <input type="password" id="senha" name="senha" required placeholder="a123456">
                    </div>
                    
                    <button type="submit" class="btn" id="loginBtn">
                        üö™ Entrar no Sistema
                    </button>
                </form>
            </div>
        </div>

        <!-- Dashboard Principal -->
        <div id="dashboard" class="dashboard">
            <div class="dashboard-header">
                <h2>üè† Dashboard - <span id="nomePropriedade"></span></h2>
                <div class="user-info">
                    <p>üë§ <span id="nomeUsuario"></span></p>
                    <button class="btn btn-small" onclick="logout()">üö™ Sair</button>
                </div>
            </div>

            <!-- Estat√≠sticas Resumidas -->
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <h3 id="totalAnimais">0</h3>
                    <p>Total de Animais</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalMachos">0</h3>
                    <p>Machos</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalFemeas">0</h3>
                    <p>F√™meas</p>
                </div>
                <div class="stat-card">
                    <h3 id="pesoMedio">0 kg</h3>
                    <p>Peso M√©dio</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalReceitas">R$ 0,00</h3>
                    <p>Receitas</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalDespesas">R$ 0,00</h3>
                    <p>Despesas</p>
                </div>
                <div class="stat-card">
                    <h3 id="saldoTotal">R$ 0,00</h3>
                    <p>Saldo</p>
                </div>
                <div class="stat-card">
                    <h3 id="animaisGestantes">0</h3>
                    <p>Gestantes</p>
                </div>
            </div>

            <div class="modules">
                <div class="module-card" onclick="abrirModulo('animais')">
                    <div class="icon">üêÑ</div>
                    <h3>Gest√£o de Animais</h3>
                    <p>Cadastro e controle do rebanho</p>
                </div>

                <div class="module-card" onclick="abrirModulo('financeiro')">
                    <div class="icon">üí∞</div>
                    <h3>Controle Financeiro</h3>
                    <p>Receitas e despesas</p>
                </div>

                <div class="module-card" onclick="abrirModulo('reproducao')">
                    <div class="icon">üíï</div>
                    <h3>Controle Reprodutivo</h3>
                    <p>Insemina√ß√£o e gesta√ß√£o</p>
                </div>

                <div class="module-card" onclick="abrirModulo('sanitario')">
                    <div class="icon">üíâ</div>
                    <h3>Controle Sanit√°rio</h3>
                    <p>Vacinas e verm√≠fugos</p>
                </div>

                <div class="module-card" onclick="abrirModulo('pesagem')">
                    <div class="icon">‚öñÔ∏è</div>
                    <h3>Controle de Pesagem</h3>
                    <p>Peso e GMD</p>
                </div>

                <div class="module-card" onclick="abrirModulo('relatorios')">
                    <div class="icon">üìä</div>
                    <h3>Relat√≥rios</h3>
                    <p>An√°lises e fichas</p>
                </div>

                <div class="module-card" onclick="abrirModulo('metas')">
                    <div class="icon">üéØ</div>
                    <h3>Metas</h3>
                    <p>Objetivos e acompanhamento</p>
                </div>

                <div class="module-card" onclick="abrirModulo('configuracoes')">
                    <div class="icon">‚öôÔ∏è</div>
                    <h3>Configura√ß√µes</h3>
                    <p>Configura√ß√µes do sistema</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Gest√£o de Animais -->
    <div id="modalAnimais" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üêÑ Gest√£o de Animais</h2>
                <button class="close-btn" onclick="fecharModal('modalAnimais')">&times;</button>
            </div>
            
            <div class="tabs">
                <div class="tab active" onclick="abrirTab('tabListaAnimais')">üìã Lista de Animais</div>
                <div class="tab" onclick="abrirTab('tabCadastroAnimal')">‚ûï Cadastrar Animal</div>
            </div>

            <div id="tabListaAnimais" class="tab-content active">
                <div class="alert alert-success" id="alertAnimaisSuccess"></div>
                <div class="alert alert-error" id="alertAnimaisError"></div>
                
                <div class="loading" id="loadingAnimais">
                    <div class="spinner"></div>
                    <p>Carregando animais...</p>
                </div>
                
                <table class="table" id="tabelaAnimais">
                    <thead>
                        <tr>
                            <th>N√∫mero</th>
                            <th>Nome</th>
                            <th>Sexo</th>
                            <th>Ra√ßa</th>
                            <th>Lote</th>
                            <th>Peso</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="corpoTabelaAnimais">
                    </tbody>
                </table>
            </div>

            <div id="tabCadastroAnimal" class="tab-content">
                <form id="formAnimal">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="numeroAnimal">üî¢ N√∫mero do Animal</label>
                            <input type="text" id="numeroAnimal" name="numero" required placeholder="0001" maxlength="4">
                        </div>
                        <div class="form-group">
                            <label for="nomeAnimal">üìù Nome (Opcional)</label>
                            <input type="text" id="nomeAnimal" name="nome" placeholder="Nome do animal">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sexoAnimal">‚ö• Sexo</label>
                            <select id="sexoAnimal" name="sexo" required>
                                <option value="">Selecione...</option>
                                <option value="Macho">Macho</option>
                                <option value="F√™mea">F√™mea</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="racaAnimal">üêÑ Ra√ßa</label>
                            <select id="racaAnimal" name="raca" required>
                                <option value="">Selecione...</option>
                                <option value="Nelore">Nelore</option>
                                <option value="Angus">Angus</option>
                                <option value="Brahman">Brahman</option>
                                <option value="Gir">Gir</option>
                                <option value="Guzer√°">Guzer√°</option>
                                <option value="Indubrasil">Indubrasil</option>
                                <option value="Tabapu√£">Tabapu√£</option>
                                <option value="Canchim">Canchim</option>
                                <option value="Santa Gertrudes">Santa Gertrudes</option>
                                <option value="Brangus">Brangus</option>
                                <option value="Senepol">Senepol</option>
                                <option value="Cruzado">Cruzado</option>
                                <option value="Outras">Outras</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group autocomplete">
                            <label for="loteAnimal">üì¶ Lote</label>
                            <input type="text" id="loteAnimal" name="lote" required placeholder="Ex: Lote 1">
                            <div id="autocomplete-lotes" class="autocomplete-items"></div>
                        </div>
                        <div class="form-group">
                            <label for="dataNascimento">üìÖ Data de Nascimento</label>
                            <input type="date" id="dataNascimento" name="dataNascimento">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pesoAtual">‚öñÔ∏è Peso Atual (kg)</label>
                            <input type="number" id="pesoAtual" name="pesoAtual" step="0.1" placeholder="0.0">
                        </div>
                        <div class="form-group">
                            <label for="statusAnimal">üìä Status</label>
                            <select id="statusAnimal" name="status" required>
                                <option value="Ativo">Ativo</option>
                                <option value="Vendido">Vendido</option>
                                <option value="Morto">Morto</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="paiAnimal">üë® Pai (Opcional)</label>
                            <input type="text" id="paiAnimal" name="pai" placeholder="N√∫mero ou nome do pai">
                        </div>
                        <div class="form-group">
                            <label for="maeAnimal">üë© M√£e (Opcional)</label>
                            <input type="text" id="maeAnimal" name="mae" placeholder="N√∫mero ou nome da m√£e">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="observacoesAnimal">üìù Observa√ß√µes</label>
                        <textarea id="observacoesAnimal" name="observacoes" rows="3" placeholder="Observa√ß√µes adicionais..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn" id="btnSalvarAnimal">
                        üíæ Salvar Animal
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Controle Financeiro -->
    <div id="modalFinanceiro" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üí∞ Controle Financeiro</h2>
                <button class="close-btn" onclick="fecharModal('modalFinanceiro')">&times;</button>
            </div>
            
            <div class="tabs">
                <div class="tab active" onclick="abrirTab('tabListaTransacoes')">üìã Transa√ß√µes</div>
                <div class="tab" onclick="abrirTab('tabNovaTransacao')">‚ûï Nova Transa√ß√£o</div>
            </div>

            <div id="tabListaTransacoes" class="tab-content active">
                <div class="alert alert-success" id="alertFinanceiroSuccess"></div>
                <div class="alert alert-error" id="alertFinanceiroError"></div>
                
                <div class="loading" id="loadingFinanceiro">
                    <div class="spinner"></div>
                    <p>Carregando transa√ß√µes...</p>
                </div>
                
                <table class="table" id="tabelaFinanceiro">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Tipo</th>
                            <th>Categoria</th>
                            <th>Valor</th>
                            <th>Descri√ß√£o</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="corpoTabelaFinanceiro">
                    </tbody>
                </table>
            </div>

            <div id="tabNovaTransacao" class="tab-content">
                <form id="formTransacao">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dataTransacao">üìÖ Data</label>
                            <input type="date" id="dataTransacao" name="data" required>
                        </div>
                        <div class="form-group">
                            <label for="tipoTransacao">üìä Tipo</label>
                            <select id="tipoTransacao" name="tipo" required onchange="carregarCategorias()">
                                <option value="">Selecione...</option>
                                <option value="Receita">Receita</option>
                                <option value="Despesa">Despesa</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="categoriaTransacao">üìã Categoria</label>
                            <select id="categoriaTransacao" name="categoria" required onchange="carregarSubcategorias()">
                                <option value="">Selecione o tipo primeiro...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="subcategoriaTransacao">üìù Subcategoria</label>
                            <select id="subcategoriaTransacao" name="subcategoria" required>
                                <option value="">Selecione a categoria primeiro...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="valorTransacao">üíµ Valor (R$)</label>
                            <input type="number" id="valorTransacao" name="valor" step="0.01" required placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="formaPagamento">üí≥ Forma de Pagamento</label>
                            <select id="formaPagamento" name="formaPagamento" required>
                                <option value="">Selecione...</option>
                                <option value="Dinheiro">Dinheiro</option>
                                <option value="PIX">PIX</option>
                                <option value="Cart√£o D√©bito">Cart√£o D√©bito</option>
                                <option value="Cart√£o Cr√©dito">Cart√£o Cr√©dito</option>
                                <option value="Transfer√™ncia">Transfer√™ncia</option>
                                <option value="Cheque">Cheque</option>
                                <option value="Boleto">Boleto</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="descricaoTransacao">üìù Descri√ß√£o</label>
                        <input type="text" id="descricaoTransacao" name="descricao" required placeholder="Descri√ß√£o da transa√ß√£o">
                    </div>
                    
                    <div class="form-group">
                        <label for="observacoesTransacao">üìù Observa√ß√µes</label>
                        <textarea id="observacoesTransacao" name="observacoes" rows="3" placeholder="Observa√ß√µes adicionais..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn" id="btnSalvarTransacao">
                        üíæ Salvar Transa√ß√£o
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Controle Reprodutivo -->
    <div id="modalReproducao" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üíï Controle Reprodutivo</h2>
                <button class="close-btn" onclick="fecharModal('modalReproducao')">&times;</button>
            </div>
            
            <div class="tabs">
                <div class="tab active" onclick="abrirTab('tabListaReproducao')">üìã Registros</div>
                <div class="tab" onclick="abrirTab('tabNovoReproducao')">‚ûï Novo Registro</div>
            </div>

            <div id="tabListaReproducao" class="tab-content active">
                <div class="alert alert-success" id="alertReproducaoSuccess"></div>
                <div class="alert alert-error" id="alertReproducaoError"></div>
                
                <div class="loading" id="loadingReproducao">
                    <div class="spinner"></div>
                    <p>Carregando registros...</p>
                </div>
                
                <table class="table" id="tabelaReproducao">
                    <thead>
                        <tr>
                            <th>Animal</th>
                            <th>Data</th>
                            <th>Tipo</th>
                            <th>Touro/S√™men</th>
                            <th>Previs√£o Parto</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="corpoTabelaReproducao">
                    </tbody>
                </table>
            </div>

            <div id="tabNovoReproducao" class="tab-content">
                <form id="formReproducao">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="animalReproducao">üêÑ Animal</label>
                            <select id="animalReproducao" name="animal" required>
                                <option value="">Selecione o animal...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dataReproducao">üìÖ Data</label>
                            <input type="date" id="dataReproducao" name="data" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tipoReproducao">üî¨ Tipo</label>
                            <select id="tipoReproducao" name="tipo" required>
                                <option value="">Selecione...</option>
                                <option value="Insemina√ß√£o Artificial">Insemina√ß√£o Artificial</option>
                                <option value="Monta Natural">Monta Natural</option>
                                <option value="Transfer√™ncia de Embri√£o">Transfer√™ncia de Embri√£o</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="touroSemen">üêÇ Touro/S√™men</label>
                            <input type="text" id="touroSemen" name="touro" placeholder="Nome do touro ou c√≥digo do s√™men">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="statusReproducao">üìä Status</label>
                            <select id="statusReproducao" name="status" required>
                                <option value="Aguardando">Aguardando</option>
                                <option value="Prenha">Prenha</option>
                                <option value="Vazia">Vazia</option>
                                <option value="Repetir Cio">Repetir Cio</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="previsaoPartoReproducao">üìÖ Previs√£o do Parto</label>
                            <input type="date" id="previsaoPartoReproducao" name="previsaoParto">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="observacoesReproducao">üìù Observa√ß√µes</label>
                        <textarea id="observacoesReproducao" name="observacoes" rows="3" placeholder="Observa√ß√µes sobre o procedimento..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn" id="btnSalvarReproducao">
                        üíæ Salvar Registro
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Controle Sanit√°rio -->
    <div id="modalSanitario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üíâ Controle Sanit√°rio</h2>
                <button class="close-btn" onclick="fecharModal('modalSanitario')">&times;</button>
            </div>
            
            <div class="tabs">
                <div class="tab active" onclick="abrirTab('tabListaSanitario')">üìã Registros</div>
                <div class="tab" onclick="abrirTab('tabNovoSanitario')">‚ûï Nova Aplica√ß√£o</div>
            </div>

            <div id="tabListaSanitario" class="tab-content active">
                <div class="alert alert-success" id="alertSanitarioSuccess"></div>
                <div class="alert alert-error" id="alertSanitarioError"></div>
                
                <div class="loading" id="loadingSanitario">
                    <div class="spinner"></div>
                    <p>Carregando registros...</p>
                </div>
                
                <table class="table" id="tabelaSanitario">
                    <thead>
                        <tr>
                            <th>Animal</th>
                            <th>Data</th>
                            <th>Tipo</th>
                            <th>Produto</th>
                            <th>Pr√≥xima Aplica√ß√£o</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="corpoTabelaSanitario">
                    </tbody>
                </table>
            </div>

            <div id="tabNovoSanitario" class="tab-content">
                <form id="formSanitario">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="animalSanitario">üêÑ Animal</label>
                            <select id="animalSanitario" name="animal" required>
                                <option value="">Selecione o animal...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dataSanitario">üìÖ Data da Aplica√ß√£o</label>
                            <input type="date" id="dataSanitario" name="data" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tipoSanitario">üíâ Tipo</label>
                            <select id="tipoSanitario" name="tipo" required onchange="calcularProximaAplicacao()">
                                <option value="">Selecione...</option>
                                <option value="Vacina">Vacina</option>
                                <option value="Verm√≠fugo">Verm√≠fugo</option>
                                <option value="Carrapaticida">Carrapaticida</option>
                                <option value="Vitamina">Vitamina</option>
                                <option value="Antibi√≥tico">Antibi√≥tico</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="produtoSanitario">üß™ Produto</label>
                            <input type="text" id="produtoSanitario" name="produto" required placeholder="Nome do produto">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="doseSanitario">üíä Dose</label>
                            <input type="text" id="doseSanitario" name="dose" placeholder="Ex: 5ml, 1 comprimido">
                        </div>
                        <div class="form-group">
                            <label for="proximaAplicacaoSanitario">üìÖ Pr√≥xima Aplica√ß√£o</label>
                            <input type="date" id="proximaAplicacaoSanitario" name="proximaAplicacao">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="observacoesSanitario">üìù Observa√ß√µes</label>
                        <textarea id="observacoesSanitario" name="observacoes" rows="3" placeholder="Observa√ß√µes sobre a aplica√ß√£o..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn" id="btnSalvarSanitario">
                        üíæ Salvar Aplica√ß√£o
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Controle de Pesagem -->
    <div id="modalPesagem" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öñÔ∏è Controle de Pesagem</h2>
                <button class="close-btn" onclick="fecharModal('modalPesagem')">&times;</button>
            </div>
            
            <div class="tabs">
                <div class="tab active" onclick="abrirTab('tabListaPesagem')">üìã Pesagens</div>
                <div class="tab" onclick="abrirTab('tabNovaPesagem')">‚ûï Nova Pesagem</div>
            </div>

            <div id="tabListaPesagem" class="tab-content active">
                <div class="alert alert-success" id="alertPesagemSuccess"></div>
                <div class="alert alert-error" id="alertPesagemError"></div>
                
                <div class="loading" id="loadingPesagem">
                    <div class="spinner"></div>
                    <p>Carregando pesagens...</p>
                </div>
                
                <table class="table" id="tabelaPesagem">
                    <thead>
                        <tr>
                            <th>Animal</th>
                            <th>Data</th>
                            <th>Peso (kg)</th>
                            <th>GMD (kg/dia)</th>
                            <th>Observa√ß√µes</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="corpoTabelaPesagem">
                    </tbody>
                </table>
            </div>

            <div id="tabNovaPesagem" class="tab-content">
                <form id="formPesagem">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="animalPesagem">üêÑ Animal</label>
                            <select id="animalPesagem" name="animal" required>
                                <option value="">Selecione o animal...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dataPesagem">üìÖ Data da Pesagem</label>
                            <input type="date" id="dataPesagem" name="data" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pesoPesagem">‚öñÔ∏è Peso (kg)</label>
                            <input type="number" id="pesoPesagem" name="peso" step="0.1" required placeholder="0.0">
                        </div>
                        <div class="form-group">
                            <label for="gmdPesagem">üìà GMD (kg/dia)</label>
                            <input type="number" id="gmdPesagem" name="gmd" step="0.001" placeholder="Calculado automaticamente" readonly>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="observacoesPesagem">üìù Observa√ß√µes</label>
                        <textarea id="observacoesPesagem" name="observacoes" rows="3" placeholder="Observa√ß√µes sobre a pesagem..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn" id="btnSalvarPesagem">
                        üíæ Salvar Pesagem
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Relat√≥rios -->
    <div id="modalRelatorios" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìä Relat√≥rios e Fichas</h2>
                <button class="close-btn" onclick="fecharModal('modalRelatorios')">&times;</button>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 30px;">
                <button class="btn" onclick="gerarRelatorio('animais_inseminados_60_dias')">
                    üìä Animais Inseminados (60 dias)
                </button>
                <button class="btn" onclick="gerarRelatorio('previsao_partos')">
                    üìÖ Previs√£o de Partos
                </button>
                <button class="btn" onclick="gerarRelatorio('controle_peso_gmd')">
                    ‚öñÔ∏è Controle de Peso/GMD
                </button>
                <button class="btn" onclick="gerarRelatorio('animais_por_lote')">
                    üì¶ Animais por Lote
                </button>
                <button class="btn" onclick="gerarRelatorio('ficha_pesagem')">
                    üìÑ Ficha de Pesagem (PDF)
                </button>
                <button class="btn" onclick="gerarRelatorio('ficha_inseminacao')">
                    üìÑ Ficha de Insemina√ß√£o (PDF)
                </button>
                <button class="btn" onclick="gerarRelatorio('ficha_cadastro')">
                    üìÑ Ficha de Cadastro (PDF)
                </button>
                <button class="btn" onclick="gerarRelatorio('taxa_prenhez')">
                    üìä Taxa de Prenhez
                </button>
            </div>
            
            <div class="loading" id="loadingRelatorio">
                <div class="spinner"></div>
                <p>Gerando relat√≥rio...</p>
            </div>
            
            <div id="resultadoRelatorio" style="margin-top: 20px;"></div>
        </div>
    </div>

    <!-- Modal Metas -->
    <div id="modalMetas" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üéØ Sistema de Metas</h2>
                <button class="close-btn" onclick="fecharModal('modalMetas')">&times;</button>
            </div>
            
            <div class="tabs">
                <div class="tab active" onclick="abrirTab('tabListaMetas')">üìã Metas</div>
                <div class="tab" onclick="abrirTab('tabNovaMeta')">‚ûï Nova Meta</div>
            </div>

            <div id="tabListaMetas" class="tab-content active">
                <div class="alert alert-success" id="alertMetasSuccess"></div>
                <div class="alert alert-error" id="alertMetasError"></div>
                
                <div class="loading" id="loadingMetas">
                    <div class="spinner"></div>
                    <p>Carregando metas...</p>
                </div>
                
                <table class="table" id="tabelaMetas">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Descri√ß√£o</th>
                            <th>Meta</th>
                            <th>Atual</th>
                            <th>Progresso</th>
                            <th>Prazo</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="corpoTabelaMetas">
                    </tbody>
                </table>
            </div>

            <div id="tabNovaMeta" class="tab-content">
                <form id="formMetas">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tipoMeta">üéØ Tipo de Meta</label>
                            <select id="tipoMeta" name="tipo" required>
                                <option value="">Selecione...</option>
                                <option value="GMD">Ganho M√©dio Di√°rio (GMD)</option>
                                <option value="Taxa de Prenhez">Taxa de Prenhez</option>
                                <option value="Peso M√©dio">Peso M√©dio do Rebanho</option>
                                <option value="Receita">Meta de Receita</option>
                                <option value="Despesa">Controle de Despesa</option>
                                <option value="Produtividade">Produtividade</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="descricaoMeta">üìù Descri√ß√£o</label>
                            <input type="text" id="descricaoMeta" name="descricao" required placeholder="Descri√ß√£o da meta">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="valorMeta">üéØ Valor da Meta</label>
                            <input type="number" id="valorMeta" name="valor" step="0.01" required placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label for="unidadeMeta">üìè Unidade</label>
                            <select id="unidadeMeta" name="unidade" required>
                                <option value="">Selecione...</option>
                                <option value="kg/dia">kg/dia</option>
                                <option value="%">%</option>
                                <option value="kg">kg</option>
                                <option value="R$">R$</option>
                                <option value="cabe√ßas">cabe√ßas</option>
                                <option value="litros">litros</option>
                                <option value="outros">outros</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="prazoMeta">üìÖ Prazo</label>
                            <input type="date" id="prazoMeta" name="prazo" required>
                        </div>
                        <div class="form-group">
                            <label for="statusMeta">üìä Status</label>
                            <select id="statusMeta" name="status" required>
                                <option value="Ativa">Ativa</option>
                                <option value="Pausada">Pausada</option>
                                <option value="Conclu√≠da">Conclu√≠da</option>
                                <option value="Cancelada">Cancelada</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="observacoesMeta">üìù Observa√ß√µes</label>
                        <textarea id="observacoesMeta" name="observacoes" rows="3" placeholder="Observa√ß√µes sobre a meta..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn" id="btnSalvarMeta">
                        üíæ Salvar Meta
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Configura√ß√µes -->
    <div id="modalConfiguracoes" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Configura√ß√µes</h2>
                <button class="close-btn" onclick="fecharModal('modalConfiguracoes')">&times;</button>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <button class="btn" onclick="abrirConfiguracaoPropriedade()">
                    üè† Dados da Propriedade
                </button>
                <button class="btn" onclick="abrirGestaoUsuarios()">
                    üë• Gest√£o de Usu√°rios
                </button>
                <button class="btn" onclick="abrirBackupDados()">
                    üíæ Backup de Dados
                </button>
                <button class="btn" onclick="abrirImportarDados()">
                    üì• Importar Dados
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√£o da API
        const API_URL = 'https://script.google.com/macros/s/AKfycbxkC2-X5jWFx2mfNn6-eGag0M9uy-k5gq6x35AVHeTZ1ylFPOu_0ddGphh6UpZ3gb57/exec';
        
        // Vari√°veis globais
        let usuarioLogado = null;
        let propriedadeAtual = null;
        let isProcessing = false;
        let animaisCarregados = [];

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar data atual nos formul√°rios
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('dataTransacao').value = hoje;
            document.getElementById('dataReproducao').value = hoje;
            document.getElementById('dataSanitario').value = hoje;
            document.getElementById('dataPesagem').value = hoje;
            
            // Event listeners
            document.getElementById('loginForm').addEventListener('submit', realizarLogin);
            document.getElementById('formAnimal').addEventListener('submit', salvarAnimal);
            document.getElementById('formTransacao').addEventListener('submit', salvarTransacao);
            document.getElementById('formReproducao').addEventListener('submit', salvarReproducao);
            document.getElementById('formSanitario').addEventListener('submit', salvarSanitario);
            document.getElementById('formPesagem').addEventListener('submit', salvarPesagem);
            document.getElementById('formMetas').addEventListener('submit', salvarMeta);
            
            // Autocomplete para lotes
            document.getElementById('loteAnimal').addEventListener('input', function() {
                buscarLotesExistentes(this.value);
            });
            
            // Formata√ß√£o autom√°tica do n√∫mero do animal
            document.getElementById('numeroAnimal').addEventListener('input', function() {
                formatarNumeroAnimal(this);
            });

            // Calcular GMD automaticamente
            document.getElementById('animalPesagem').addEventListener('change', calcularGMD);
            document.getElementById('pesoPesagem').addEventListener('input', calcularGMD);
            document.getElementById('dataPesagem').addEventListener('change', calcularGMD);
        });

        // Fun√ß√£o de Login
        async function realizarLogin(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const email = formData.get('email');
            const senha = formData.get('senha');
            
            const loginBtn = document.getElementById('loginBtn');
            loginBtn.disabled = true;
            loginBtn.innerHTML = 'üîÑ Entrando...';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'login',
                        email: email,
                        senha: senha
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    usuarioLogado = resultado.dados.usuario;
                    propriedadeAtual = resultado.dados.propriedade;
                    mostrarDashboard();
                    await carregarEstatisticas();
                } else {
                    mostrarAlerta('loginError', resultado.mensagem);
                }
            } catch (error) {
                mostrarAlerta('loginError', 'Erro de conex√£o. Tente novamente.');
            } finally {
                loginBtn.disabled = false;
                loginBtn.innerHTML = 'üö™ Entrar no Sistema';
            }
        }

        // Mostrar dashboard
        function mostrarDashboard() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('nomeUsuario').textContent = usuarioLogado;
            document.getElementById('nomePropriedade').textContent = propriedadeAtual;
        }

        // Logout
        function logout() {
            usuarioLogado = null;
            propriedadeAtual = null;
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
            
            // Limpar formul√°rios
            document.getElementById('loginForm').reset();
            esconderAlerta('loginError');
        }

        // Carregar estat√≠sticas do dashboard
        async function carregarEstatisticas() {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'carregarEstatisticas',
                        propriedade: propriedadeAtual
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    const stats = resultado.dados;
                    document.getElementById('totalAnimais').textContent = stats.totalAnimais || 0;
                    document.getElementById('totalMachos').textContent = stats.totalMachos || 0;
                    document.getElementById('totalFemeas').textContent = stats.totalFemeas || 0;
                    document.getElementById('pesoMedio').textContent = (stats.pesoMedio || 0) + ' kg';
                    document.getElementById('totalReceitas').textContent = 'R$ ' + (stats.totalReceitas || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2});
                    document.getElementById('totalDespesas').textContent = 'R$ ' + (stats.totalDespesas || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2});
                    document.getElementById('saldoTotal').textContent = 'R$ ' + (stats.saldoTotal || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2});
                    document.getElementById('animaisGestantes').textContent = stats.animaisGestantes || 0;
                }
            } catch (error) {
                console.log('Erro ao carregar estat√≠sticas:', error);
            }
        }

        // Abrir m√≥dulos
        function abrirModulo(modulo) {
            switch(modulo) {
                case 'animais':
                    abrirModalAnimais();
                    break;
                case 'financeiro':
                    abrirModalFinanceiro();
                    break;
                case 'reproducao':
                    abrirModalReproducao();
                    break;
                case 'sanitario':
                    abrirModalSanitario();
                    break;
                case 'pesagem':
                    abrirModalPesagem();
                    break;
                case 'relatorios':
                    abrirModalRelatorios();
                    break;
                case 'metas':
                    abrirModalMetas();
                    break;
                case 'configuracoes':
                    abrirModalConfiguracoes();
                    break;
                default:
                    alert('M√≥dulo n√£o encontrado');
            }
        }

        // Gerenciar abas
        function abrirTab(tabId) {
            // Esconder todas as abas
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.classList.remove('active'));
            
            // Remover classe active de todas as abas
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Mostrar aba selecionada
            document.getElementById(tabId).classList.add('active');
            
            // Adicionar classe active na aba clicada
            event.target.classList.add('active');
        }

        // Modal Animais
        async function abrirModalAnimais() {
            document.getElementById('modalAnimais').style.display = 'block';
            await carregarAnimais();
            await carregarAnimaisSelect();
        }

        async function carregarAnimais() {
            document.getElementById('loadingAnimais').style.display = 'block';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'listarAnimais',
                        propriedade: propriedadeAtual
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    animaisCarregados = resultado.dados;
                    preencherTabelaAnimais(resultado.dados);
                } else {
                    mostrarAlerta('alertAnimaisError', resultado.mensagem);
                }
            } catch (error) {
                mostrarAlerta('alertAnimaisError', 'Erro ao carregar animais');
            } finally {
                document.getElementById('loadingAnimais').style.display = 'none';
            }
        }

        function preencherTabelaAnimais(animais) {
            const tbody = document.getElementById('corpoTabelaAnimais');
            tbody.innerHTML = '';
            
            animais.forEach(animal => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${animal.numero}</td>
                    <td>${animal.nome || '-'}</td>
                    <td>${animal.sexo}</td>
                    <td>${animal.raca}</td>
                    <td>${animal.lote}</td>
                    <td>${animal.pesoAtual ? animal.pesoAtual + ' kg' : '-'}</td>
                    <td>${animal.status}</td>
                    <td>
                        <button class="btn btn-small" onclick="editarAnimal('${animal.numero}')">‚úèÔ∏è</button>
                        <button class="btn btn-small btn-danger" onclick="excluirAnimal('${animal.numero}')">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function salvarAnimal(event) {
            event.preventDefault();
            
            if (isProcessing) return;
            isProcessing = true;
            
            const formData = new FormData(event.target);
            const dadosAnimal = Object.fromEntries(formData.entries());
            dadosAnimal.propriedade = propriedadeAtual;
            
            const btnSalvar = document.getElementById('btnSalvarAnimal');
            btnSalvar.disabled = true;
            btnSalvar.innerHTML = 'üíæ Salvando...';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'salvarAnimal',
                        dados: dadosAnimal
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    mostrarAlerta('alertAnimaisSuccess', 'Animal salvo com sucesso!');
                    document.getElementById('formAnimal').reset();
                    await carregarAnimais();
                    await carregarEstatisticas();
                    abrirTab('tabListaAnimais');
                } else {
                    mostrarAlerta('alertAnimaisError', resultado.mensagem);
                }
            } catch (error) {
                mostrarAlerta('alertAnimaisError', 'Erro ao salvar animal');
            } finally {
                btnSalvar.disabled = false;
                btnSalvar.innerHTML = 'üíæ Salvar Animal';
                isProcessing = false;
            }
        }

        // Formata√ß√£o do n√∫mero do animal
        function formatarNumeroAnimal(input) {
            let valor = input.value.replace(/\D/g, ''); // Remove n√£o-d√≠gitos
            
            if (valor.length > 0) {
                valor = valor.padStart(4, '0'); // Adiciona zeros √† esquerda
                if (valor.length > 4) {
                    valor = valor.substring(0, 4); // Limita a 4 d√≠gitos
                }
            }
            
            input.value = valor;
        }

        // Buscar lotes existentes para autocomplete
        async function buscarLotesExistentes(termo) {
            if (termo.length < 1) {
                document.getElementById('autocomplete-lotes').innerHTML = '';
                return;
            }
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'listarLotes',
                        propriedade: propriedadeAtual,
                        termo: termo
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    mostrarSugestoesLotes(resultado.dados);
                }
            } catch (error) {
                console.log('Erro ao buscar lotes:', error);
            }
        }

        function mostrarSugestoesLotes(lotes) {
            const container = document.getElementById('autocomplete-lotes');
            container.innerHTML = '';
            
            lotes.forEach(lote => {
                const div = document.createElement('div');
                div.className = 'autocomplete-item';
                div.textContent = lote;
                div.onclick = function() {
                    document.getElementById('loteAnimal').value = lote;
                    container.innerHTML = '';
                };
                container.appendChild(div);
            });
        }

        // Modal Financeiro
        async function abrirModalFinanceiro() {
            document.getElementById('modalFinanceiro').style.display = 'block';
            await carregarTransacoes();
        }

        async function carregarTransacoes() {
            document.getElementById('loadingFinanceiro').style.display = 'block';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'listarTransacoes',
                        propriedade: propriedadeAtual
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    preencherTabelaFinanceiro(resultado.dados);
                } else {
                    mostrarAlerta('alertFinanceiroError', resultado.mensagem);
                }
            } catch (error) {
                mostrarAlerta('alertFinanceiroError', 'Erro ao carregar transa√ß√µes');
            } finally {
                document.getElementById('loadingFinanceiro').style.display = 'none';
            }
        }

        function preencherTabelaFinanceiro(transacoes) {
            const tbody = document.getElementById('corpoTabelaFinanceiro');
            tbody.innerHTML = '';
            
            transacoes.forEach(transacao => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${new Date(transacao.data).toLocaleDateString('pt-BR')}</td>
                    <td>${transacao.tipo}</td>
                    <td>${transacao.categoria}</td>
                    <td>R$ ${parseFloat(transacao.valor).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td>${transacao.descricao}</td>
                    <td>
                        <button class="btn btn-small" onclick="editarTransacao('${transacao.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-small btn-danger" onclick="excluirTransacao('${transacao.id}')">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function salvarTransacao(event) {
            event.preventDefault();
            
            if (isProcessing) return;
            isProcessing = true;
            
            const formData = new FormData(event.target);
            const dadosTransacao = Object.fromEntries(formData.entries());
            dadosTransacao.propriedade = propriedadeAtual;
            
            const btnSalvar = document.getElementById('btnSalvarTransacao');
            btnSalvar.disabled = true;
            btnSalvar.innerHTML = 'üíæ Salvando...';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'salvarTransacao',
                        dados: dadosTransacao
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    mostrarAlerta('alertFinanceiroSuccess', 'Transa√ß√£o salva com sucesso!');
                    document.getElementById('formTransacao').reset();
                    const hoje = new Date().toISOString().split('T')[0];
                    document.getElementById('dataTransacao').value = hoje;
                    await carregarTransacoes();
                    await carregarEstatisticas();
                    abrirTab('tabListaTransacoes');
                } else {
                    mostrarAlerta('alertFinanceiroError', resultado.mensagem);
                }
            } catch (error) {
                mostrarAlerta('alertFinanceiroError', 'Erro ao salvar transa√ß√£o');
            } finally {
                btnSalvar.disabled = false;
                btnSalvar.innerHTML = 'üíæ Salvar Transa√ß√£o';
                isProcessing = false;
            }
        }

        // Carregar categorias financeiras
        function carregarCategorias() {
            const tipo = document.getElementById('tipoTransacao').value;
            const selectCategoria = document.getElementById('categoriaTransacao');
            const selectSubcategoria = document.getElementById('subcategoriaTransacao');
            
            selectCategoria.innerHTML = '<option value="">Selecione...</option>';
            selectSubcategoria.innerHTML = '<option value="">Selecione a categoria primeiro...</option>';
            
            if (tipo === 'Receita') {
                const categoriasReceita = [
                    '01 - Venda de Animais',
                    '02 - Venda de Produtos',
                    '03 - Servi√ßos',
                    '04 - Outras Receitas'
                ];
                
                categoriasReceita.forEach(categoria => {
                    const option = document.createElement('option');
                    option.value = categoria;
                    option.textContent = categoria;
                    selectCategoria.appendChild(option);
                });
            } else if (tipo === 'Despesa') {
                const categoriasDespesa = [
                    '01 - Aquisi√ß√£o de Animais',
                    '02 - Alimenta√ß√£o Animal',
                    '03 - Sanidade Animal',
                    '04 - Reprodu√ß√£o',
                    '05 - M√£o de Obra',
                    '06 - Combust√≠vel',
                    '07 - Energia El√©trica',
                    '08 - Manuten√ß√£o de Equipamentos',
                    '09 - Manuten√ß√£o de Instala√ß√µes',
                    '10 - Impostos e Taxas',
                    '11 - Seguros',
                    '12 - Transporte',
                    '13 - Consultoria T√©cnica',
                    '14 - An√°lises Laboratoriais',
                    '15 - Material de Escrit√≥rio',
                    '16 - Despesas Banc√°rias',
                    '17 - Deprecia√ß√£o',
                    '18 - Pastagem',
                    '19 - √Ågua',
                    '20 - Cercas',
                    '21 - Equipamentos',
                    '22 - Outras Despesas'
                ];
                
                categoriasDespesa.forEach(categoria => {
                    const option = document.createElement('option');
                    option.value = categoria;
                    option.textContent = categoria;
                    selectCategoria.appendChild(option);
                });
            }
        }

        // Carregar subcategorias
        function carregarSubcategorias() {
            const categoria = document.getElementById('categoriaTransacao').value;
            const selectSubcategoria = document.getElementById('subcategoriaTransacao');
            
            selectSubcategoria.innerHTML = '<option value="">Selecione...</option>';
            
            const subcategorias = {
                '01 - Venda de Animais': ['Bovinos', 'Bezerros', 'Novilhos', 'Vacas', 'Touros'],
                '02 - Venda de Produtos': ['Leite', 'Queijo', 'Outros Derivados'],
                '03 - Servi√ßos': ['Aluguel de Pasto', 'Presta√ß√£o de Servi√ßos', 'Outros'],
                '04 - Outras Receitas': ['Subs√≠dios', 'Vendas Diversas', 'Outros'],
                
                '01 - Aquisi√ß√£o de Animais': ['Bovinos', 'Bezerros', 'Novilhos', 'Vacas', 'Touros'],
                '02 - Alimenta√ß√£o Animal': ['Ra√ß√£o', 'Sal Mineral', 'Suplementos', 'Volumoso', 'Outros'],
                '03 - Sanidade Animal': ['Vacinas', 'Medicamentos', 'Verm√≠fugos', 'Carrapaticidas', 'Outros'],
                '04 - Reprodu√ß√£o': ['S√™men', 'Insemina√ß√£o Artificial', 'Exames', 'Outros'],
                '05 - M√£o de Obra': ['Sal√°rios', 'Encargos', 'Di√°rias', 'Outros'],
                '06 - Combust√≠vel': ['Diesel', 'Gasolina', '√Ålcool', 'Outros'],
                '07 - Energia El√©trica': ['Consumo', 'Taxa de Ilumina√ß√£o'],
                '08 - Manuten√ß√£o de Equipamentos': ['Tratores', 'Implementos', 'Outros'],
                '09 - Manuten√ß√£o de Instala√ß√µes': ['Currais', 'Galp√µes', 'Outros'],
                '10 - Impostos e Taxas': ['ITR', 'INCRA', 'Sindicatos', 'Outros'],
                '11 - Seguros': ['Equipamentos', 'Instala√ß√µes', 'Outros'],
                '12 - Transporte': ['Frete', 'Combust√≠vel', 'Outros'],
                '13 - Consultoria T√©cnica': ['Veterin√°rio', 'Zootecnista', 'Agr√¥nomo', 'Outros'],
                '14 - An√°lises Laboratoriais': ['Solo', '√Ågua', 'Outros'],
                '15 - Material de Escrit√≥rio': ['Papelaria', 'Inform√°tica', 'Outros'],
                '16 - Despesas Banc√°rias': ['Tarifas', 'Juros', 'Outros'],
                '17 - Deprecia√ß√£o': ['Equipamentos', 'Instala√ß√µes', 'Outros'],
                '18 - Pastagem': ['Sementes', 'Fertilizantes', 'Defensivos', 'Outros'],
                '19 - √Ågua': ['Perfura√ß√£o', 'Manuten√ß√£o', 'Energia', 'Outros'],
                '20 - Cercas': ['Arame', 'Mour√µes', 'M√£o de Obra', 'Outros'],
                '21 - Equipamentos': ['Compra', 'Financiamento', 'Leasing', 'Outros'],
                '22 - Outras Despesas': ['Diversas', 'N√£o Classificadas', 'Outros']
            };
            
            if (subcategorias[categoria]) {
                subcategorias[categoria].forEach(subcategoria => {
                    const option = document.createElement('option');
                    option.value = subcategoria;
                    option.textContent = subcategoria;
                    selectSubcategoria.appendChild(option);
                });
            }
        }

        // Carregar animais nos selects
        async function carregarAnimaisSelect() {
            const selects = [
                'animalReproducao',
                'animalSanitario', 
                'animalPesagem'
            ];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Selecione o animal...</option>';
                    
                    animaisCarregados.forEach(animal => {
                        if (animal.status === 'Ativo') {
                            const option = document.createElement('option');
                            option.value = animal.numero;
                            option.textContent = `${animal.numero} - ${animal.nome || 'Sem nome'} (${animal.sexo})`;
                            select.appendChild(option);
                        }
                    });
                }
            });
        }

        // Modal Reprodu√ß√£o
        async function abrirModalReproducao() {
            document.getElementById('modalReproducao').style.display = 'block';
            await carregarReproducao();
        }

        async function carregarReproducao() {
            document.getElementById('loadingReproducao').style.display = 'block';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'listarReproducao',
                        propriedade: propriedadeAtual
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    preencherTabelaReproducao(resultado.dados);
                } else {
                    mostrarAlerta('alertReproducaoError', resultado.mensagem);
                }
            } catch (error) {
                mostrarAlerta('alertReproducaoError', 'Erro ao carregar registros reprodutivos');
            } finally {
                document.getElementById('loadingReproducao').style.display = 'none';
            }
        }

        function preencherTabelaReproducao(registros) {
            const tbody = document.getElementById('corpoTabelaReproducao');
            tbody.innerHTML = '';
            
            registros.forEach(registro => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${registro.animal}</td>
                    <td>${new Date(registro.data).toLocaleDateString('pt-BR')}</td>
                    <td>${registro.tipo}</td>
                    <td>${registro.touro || '-'}</td>
                    <td>${registro.previsaoParto ? new Date(registro.previsaoParto).toLocaleDateString('pt-BR') : '-'}</td>
                    <td>${registro.status}</td>
                    <td>
                        <button class="btn btn-small" onclick="editarReproducao('${registro.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-small btn-danger" onclick="excluirReproducao('${registro.id}')">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function salvarReproducao(event) {
            event.preventDefault();
            
            if (isProcessing) return;
            isProcessing = true;
            
            const formData = new FormData(event.target);
            const dadosReproducao = Object.fromEntries(formData.entries());
            dadosReproducao.propriedade = propriedadeAtual;
            
            // Calcular previs√£o de parto se n√£o informada
            if (!dadosReproducao.previsaoParto && dadosReproducao.data) {
                const dataInseminacao = new Date(dadosReproducao.data);
                dataInseminacao.setDate(dataInseminacao.getDate() + 285); // 285 dias de gesta√ß√£o
                dadosReproducao.previsaoParto = dataInseminacao.toISOString().split('T')[0];
                document.getElementById('previsaoPartoReproducao').value = dadosReproducao.previsaoParto;
            }
            
            const btnSalvar = document.getElementById('btnSalvarReproducao');
            btnSalvar.disabled = true;
            btnSalvar.innerHTML = 'üíæ Salvando...';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'salvarReproducao',
                        dados: dadosReproducao
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    mostrarAlerta('alertReproducaoSuccess', 'Registro reprodutivo salvo com sucesso!');
                    document.getElementById('formReproducao').reset();
                    const hoje = new Date().toISOString().split('T')[0];
                    document.getElementById('dataReproducao').value = hoje;
                    await carregarReproducao();
                    await carregarEstatisticas();
                    abrirTab('tabListaReproducao');
                } else {
                    mostrarAlerta('alertReproducaoError', resultado.mensagem);
                }
            } catch (error) {
                mostrarAlerta('alertReproducaoError', 'Erro ao salvar registro reprodutivo');
            } finally {
                btnSalvar.disabled = false;
                btnSalvar.innerHTML = 'üíæ Salvar Registro';
                isProcessing = false;
            }
        }

        // Modal Sanit√°rio
        async function abrirModalSanitario() {
            document.getElementById('modalSanitario').style.display = 'block';
            await carregarSanitario();
        }

        async function carregarSanitario() {
            document.getElementById('loadingSanitario').style.display = 'block';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'listarVacinas',
                        propriedade: propriedadeAtual
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    preencherTabelaSanitario(resultado.dados);
                } else {
                    mostrarAlerta('alertSanitarioError', resultado.mensagem);
                }
            } catch (error) {
                mostrarAlerta('alertSanitarioError', 'Erro ao carregar registros sanit√°rios');
            } finally {
                document.getElementById('loadingSanitario').style.display = 'none';
            }
        }

        function preencherTabelaSanitario(registros) {
            const tbody = document.getElementById('corpoTabelaSanitario');
            tbody.innerHTML = '';
            
            registros.forEach(registro => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${registro.animal}</td>
                    <td>${new Date(registro.data).toLocaleDateString('pt-BR')}</td>
                    <td>${registro.tipo}</td>
                    <td>${registro.produto}</td>
                    <td>${registro.proximaAplicacao ? new Date(registro.proximaAplicacao).toLocaleDateString('pt-BR') : '-'}</td>
                    <td>
                        <button class="btn btn-small" onclick="editarVacina('${registro.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-small btn-danger" onclick="excluirVacina('${registro.id}')">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function calcularProximaAplicacao() {
            const tipo = document.getElementById('tipoSanitario').value;
            const dataAplicacao = document.getElementById('dataSanitario').value;
            
            if (tipo && dataAplicacao) {
                const data = new Date(dataAplicacao);
                let diasAdicionar = 0;
                
                switch(tipo) {
                    case 'Verm√≠fugo':
                        diasAdicionar = 120; // 4 meses
                        break;
                    case 'Carrapaticida':
                        diasAdicionar = 90; // 3 meses
                        break;
                    case 'Vacina':
                        diasAdicionar = 365; // 1 ano
                        break;
                    case 'Vitamina':
                        diasAdicionar = 180; // 6 meses
                        break;
                    default:
                        diasAdicionar = 0;
                }
                
                if (diasAdicionar > 0) {
                    data.setDate(data.getDate() + diasAdicionar);
                    document.getElementById('proximaAplicacaoSanitario').value = data.toISOString().split('T')[0];
                }
            }
        }

        async function salvarSanitario(event) {
            event.preventDefault();
            
            if (isProcessing) return;
            isProcessing = true;
            
            const formData = new FormData(event.target);
            const dadosSanitario = Object.fromEntries(formData.entries());
            dadosSanitario.propriedade = propriedadeAtual;
            
            const btnSalvar = document.getElementById('btnSalvarSanitario');
            btnSalvar.disabled = true;
            btnSalvar.innerHTML = 'üíæ Salvando...';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'salvarVacina',
                        dados: dadosSanitario
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    mostrarAlerta('alertSanitarioSuccess', 'Aplica√ß√£o salva com sucesso!');
                    document.getElementById('formSanitario').reset();
                    const hoje = new Date().toISOString().split('T')[0];
                    document.getElementById('dataSanitario').value = hoje;
                    await carregarSanitario();
                    abrirTab('tabListaSanitario');
                } else {
                    mostrarAlerta('alertSanitarioError', resultado.mensagem);
                }
            } catch (error) {
                mostrarAlerta('alertSanitarioError', 'Erro ao salvar aplica√ß√£o');
            } finally {
                btnSalvar.disabled = false;
                btnSalvar.innerHTML = 'üíæ Salvar Aplica√ß√£o';
                isProcessing = false;
            }
        }

        // Modal Pesagem
        async function abrirModalPesagem() {
            document.getElementById('modalPesagem').style.display = 'block';
            await carregarPesagens();
        }

        async function carregarPesagens() {
            document.getElementById('loadingPesagem').style.display = 'block';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'listarPesagens',
                        propriedade: propriedadeAtual
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    preencherTabelaPesagem(resultado.dados);
                } else {
                    mostrarAlerta('alertPesagemError', resultado.mensagem);
                }
            } catch (error) {
                mostrarAlerta('alertPesagemError', 'Erro ao carregar pesagens');
            } finally {
                document.getElementById('loadingPesagem').style.display = 'none';
            }
        }

        function preencherTabelaPesagem(pesagens) {
            const tbody = document.getElementById('corpoTabelaPesagem');
            tbody.innerHTML = '';
            
            pesagens.forEach(pesagem => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${pesagem.animal}</td>
                    <td>${new Date(pesagem.data).toLocaleDateString('pt-BR')}</td>
                    <td>${pesagem.peso} kg</td>
                    <td>${pesagem.gmd ? pesagem.gmd + ' kg/dia' : '-'}</td>
                    <td>${pesagem.observacoes || '-'}</td>
                    <td>
                        <button class="btn btn-small" onclick="editarPesagem('${pesagem.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-small btn-danger" onclick="excluirPesagem('${pesagem.id}')">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function calcularGMD() {
            const animalSelecionado = document.getElementById('animalPesagem').value;
            const pesoAtual = parseFloat(document.getElementById('pesoPesagem').value);
            const dataAtual = document.getElementById('dataPesagem').value;
            
            if (animalSelecionado && pesoAtual && dataAtual) {
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            acao: 'calcularGMD',
                            animal: animalSelecionado,
                            peso: pesoAtual,
                            data: dataAtual,
                            propriedade: propriedadeAtual
                        })
                    });
                    
                    const resultado = await response.json();
                    
                    if (resultado.sucesso && resultado.dados.gmd) {
                        document.getElementById('gmdPesagem').value = resultado.dados.gmd.toFixed(3);
                    }
                } catch (error) {
                    console.log('Erro ao calcular GMD:', error);
                }
            }
        }

        async function salvarPesagem(event) {
            event.preventDefault();
            
            if (isProcessing) return;
            isProcessing = true;
            
            const formData = new FormData(event.target);
            const dadosPesagem = Object.fromEntries(formData.entries());
            dadosPesagem.propriedade = propriedadeAtual;
            
            const btnSalvar = document.getElementById('btnSalvarPesagem');
            btnSalvar.disabled = true;
            btnSalvar.innerHTML = 'üíæ Salvando...';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'salvarPesagem',
                        dados: dadosPesagem
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    mostrarAlerta('alertPesagemSuccess', 'Pesagem salva com sucesso!');
                    document.getElementById('formPesagem').reset();
                    const hoje = new Date().toISOString().split('T')[0];
                    document.getElementById('dataPesagem').value = hoje;
                    await carregarPesagens();
                    await carregarEstatisticas();
                    abrirTab('tabListaPesagem');
                } else {
                    mostrarAlerta('alertPesagemError', resultado.mensagem);
                }
            } catch (error) {
                mostrarAlerta('alertPesagemError', 'Erro ao salvar pesagem');
            } finally {
                btnSalvar.disabled = false;
                btnSalvar.innerHTML = 'üíæ Salvar Pesagem';
                isProcessing = false;
            }
        }

        // Modal Relat√≥rios
        function abrirModalRelatorios() {
            document.getElementById('modalRelatorios').style.display = 'block';
        }

        async function gerarRelatorio(tipo) {
            document.getElementById('loadingRelatorio').style.display = 'block';
            document.getElementById('resultadoRelatorio').innerHTML = '';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'gerarRelatorio',
                        tipo: tipo,
                        propriedade: propriedadeAtual
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    document.getElementById('resultadoRelatorio').innerHTML = resultado.dados;
                } else {
                    document.getElementById('resultadoRelatorio').innerHTML = '<p>Erro ao gerar relat√≥rio: ' + resultado.mensagem + '</p>';
                }
            } catch (error) {
                document.getElementById('resultadoRelatorio').innerHTML = '<p>Erro ao gerar relat√≥rio</p>';
            } finally {
                document.getElementById('loadingRelatorio').style.display = 'none';
            }
        }

        // Modal Metas
        async function abrirModalMetas() {
            document.getElementById('modalMetas').style.display = 'block';
            await carregarMetas();
        }

        async function carregarMetas() {
            document.getElementById('loadingMetas').style.display = 'block';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'listarMetas',
                        propriedade: propriedadeAtual
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    preencherTabelaMetas(resultado.dados);
                } else {
                    mostrarAlerta('alertMetasError', resultado.mensagem);
                }
            } catch (error) {
                mostrarAlerta('alertMetasError', 'Erro ao carregar metas');
            } finally {
                document.getElementById('loadingMetas').style.display = 'none';
            }
        }

        function preencherTabelaMetas(metas) {
            const tbody = document.getElementById('corpoTabelaMetas');
            tbody.innerHTML = '';
            
            metas.forEach(meta => {
                const progresso = meta.valor > 0 ? ((meta.atual / meta.valor) * 100).toFixed(1) : 0;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${meta.tipo}</td>
                    <td>${meta.descricao}</td>
                    <td>${meta.valor} ${meta.unidade || ''}</td>
                    <td>${meta.atual || 0} ${meta.unidade || ''}</td>
                    <td>${progresso}%</td>
                    <td>${meta.prazo ? new Date(meta.prazo).toLocaleDateString('pt-BR') : '-'}</td>
                    <td>
                        <button class="btn btn-small" onclick="editarMeta('${meta.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-small btn-danger" onclick="excluirMeta('${meta.id}')">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function salvarMeta(event) {
            event.preventDefault();
            
            if (isProcessing) return;
            isProcessing = true;
            
            const formData = new FormData(event.target);
            const dadosMeta = Object.fromEntries(formData.entries());
            dadosMeta.propriedade = propriedadeAtual;
            dadosMeta.atual = 0; // Valor inicial
            
            const btnSalvar = document.getElementById('btnSalvarMeta');
            btnSalvar.disabled = true;
            btnSalvar.innerHTML = 'üíæ Salvando...';
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: 'salvarMeta',
                        dados: dadosMeta
                    })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    mostrarAlerta('alertMetasSuccess', 'Meta salva com sucesso!');
                    document.getElementById('formMetas').reset();
                    await carregarMetas();
                    abrirTab('tabListaMetas');
                } else {
                    mostrarAlerta('alertMetasError', resultado.mensagem);
                }
            } catch (error) {
                mostrarAlerta('alertMetasError', 'Erro ao salvar meta');
            } finally {
                btnSalvar.disabled = false;
                btnSalvar.innerHTML = 'üíæ Salvar Meta';
                isProcessing = false;
            }
        }

        // Modal Configura√ß√µes
        function abrirModalConfiguracoes() {
            document.getElementById('modalConfiguracoes').style.display = 'block';
        }

        // Fun√ß√µes auxiliares
        function fecharModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function mostrarAlerta(elementId, mensagem) {
            const alerta = document.getElementById(elementId);
            alerta.textContent = mensagem;
            alerta.style.display = 'block';
            
            setTimeout(() => {
                alerta.style.display = 'none';
            }, 5000);
        }

        function esconderAlerta(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Fun√ß√µes placeholder para desenvolvimento futuro
        function editarAnimal(numero) { alert('Fun√ß√£o de edi√ß√£o em desenvolvimento'); }
        function excluirAnimal(numero) { 
            if (confirm('Tem certeza que deseja excluir este animal?')) {
                alert('Fun√ß√£o de exclus√£o em desenvolvimento');
            }
        }
        function editarTransacao(id) { alert('Fun√ß√£o de edi√ß√£o em desenvolvimento'); }
        function excluirTransacao(id) { 
            if (confirm('Tem certeza que deseja excluir esta transa√ß√£o?')) {
                alert('Fun√ß√£o de exclus√£o em desenvolvimento');
            }
        }
        function editarReproducao(id) { alert('Fun√ß√£o de edi√ß√£o em desenvolvimento'); }
        function excluirReproducao(id) { 
            if (confirm('Tem certeza que deseja excluir este registro?')) {
                alert('Fun√ß√£o de exclus√£o em desenvolvimento');
            }
        }
        function editarVacina(id) { alert('Fun√ß√£o de edi√ß√£o em desenvolvimento'); }
        function excluirVacina(id) { 
            if (confirm('Tem certeza que deseja excluir este registro?')) {
                alert('Fun√ß√£o de exclus√£o em desenvolvimento');
            }
        }
        function editarPesagem(id) { alert('Fun√ß√£o de edi√ß√£o em desenvolvimento'); }
        function excluirPesagem(id) { 
            if (confirm('Tem certeza que deseja excluir esta pesagem?')) {
                alert('Fun√ß√£o de exclus√£o em desenvolvimento');
            }
        }
        function editarMeta(id) { alert('Fun√ß√£o de edi√ß√£o em desenvolvimento'); }
        function excluirMeta(id) { 
            if (confirm('Tem certeza que deseja excluir esta meta?')) {
                alert('Fun√ß√£o de exclus√£o em desenvolvimento');
            }
        }
        function abrirConfiguracaoPropriedade() { alert('Fun√ß√£o em desenvolvimento'); }
        function abrirGestaoUsuarios() { alert('Fun√ß√£o em desenvolvimento'); }
        function abrirBackupDados() { alert('Fun√ß√£o em desenvolvimento'); }
        function abrirImportarDados() { alert('Fun√ß√£o em desenvolvimento'); }
    </script>
</body>
</html>

